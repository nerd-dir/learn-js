<!DOCTYPE html>
<html lang="en" class="no-js">

<!-- /popover-library-event-listeners/  Mon, 24 Jan 2022 10:07:38 GMT -->
<!-- OpenDir --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /OpenDir -->
<head>
    <meta charset="UTF-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>

<title>üõ†Ô∏è Popover: Adding event listeners | Learn JavaScript</title>
<meta name="description" content="Learn JavaScript student portal"/>
<link rel="canonical" href="index.html">


<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="../../favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicons/favicon-16x16.png">
<link rel="manifest" href="../../favicons/site.webmanifest">
<link rel="mask-icon" href="../../favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="../../favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#ffc40d">
<meta name="msapplication-config" content="../../favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- CSS -->
<link rel="stylesheet" href="../../css/styles-min-afc4baccb2.css">

<!-- Fonts -->
<script>
  (function (d) {
    var config = {
        kitId: 'gas0cwl',
        scriptTimeout: 3000,
        async: true
      },
      h = d.documentElement,
      t = setTimeout(function () {
        h.className = h
          .className
          .replace(/\bwf-loading\b/g, "") + " wf-inactive";
      }, config.scriptTimeout),
      tk = d.createElement("script"),
      f = false,
      s = d.getElementsByTagName("script")[0],
      a;
    h.className += " wf-loading";
    tk.src = 'https://use.typekit.net/' + config.kitId + '.js';
    tk.async = true;
    tk.onload = tk.onreadystatechange = function () {
      a = this.readyState;
      if (f || a && a != "complete" && a != "loaded")
        return;
      f = true;
      clearTimeout(t);
      try {
        Typekit.load(config)
      } catch (e) {}
    };
    s
      .parentNode
      .insertBefore(tk, s)
  })(document);
</script>

<script>
  document
    .documentElement
    .classList
    .remove('no-js')
</script>

</head>

  <body class="page">
      <nav class="main-nav" data-js="menu" data-state="closed">
        <div>
          <a href="../index.html"><svg
  class="logo"
  data-size="small"
  height="1em"
  viewbox="0 0 273 43"
  xmlns="http://www.w3.org/2000/svg"
>
  <g transform="translate(-1 -10)" fill="none" fill-rule="evenodd">
    <rect fill="#F8E201" x="31" y="11" width="217" height="42" />
    <path
      d="M5.21 44.261v-5.217c0-2.726-.706-4.418-3.902-5.076v-3.76c3.196-.705 3.901-2.209 3.901-4.841v-6.11c0-4.606 2.68-8.178 8.695-8.178h1.551v3.995c-3.948 0-5.546 1.645-5.546 5.264v4.23c0 3.196-.94 6.345-4.136 7.473 3.102 1.175 4.136 4.042 4.136 7.05v4.089c0 4.183 1.598 5.828 5.546 5.828v3.995h-1.55c-5.782 0-8.696-3.243-8.696-8.742zm263.967-5.217l.141 5.217c-.141 5.499-2.961 8.742-8.789 8.742h-1.551v-3.995c3.948 0 5.499-1.645 5.499-5.828v-4.089c0-3.008 1.081-5.875 4.183-7.05-3.196-1.128-4.183-4.277-4.183-7.473v-4.23c0-3.619-1.551-5.264-5.499-5.264v-3.995h1.551c5.969 0 8.648 3.572 8.648 8.178v6.11c0 2.632.705 4.136 3.901 4.841v3.76c-3.196.658-3.901 2.35-3.901 5.076z"
      fill="#000"
      fill-rule="nonzero"
    />
    <path
      d="M29.82 52V11.5h7.74v34.56h17.46V52h-25.2zM58.2 37.78c0-8.16 3.54-16.32 13.68-16.32 8.4 0 12.18 5.1 12.18 13.62 0 .96-.06 1.92-.12 3H65.76c.06 7.44 3 9.36 6.54 9.36 2.76 0 5.52-1.2 5.52-4.2 0-.24-.06-.48-.06-.78l6 .84c.06.3.06.66.06 1.02 0 5.4-5.28 8.4-11.76 8.4-8.04 0-13.86-4.62-13.86-14.94zm13.62-11.7c-2.76 0-5.04 2.04-5.82 7.5h10.56v-1.02c0-3.48-1.38-6.48-4.74-6.48zM88.2 44.26c0-6.36 6.06-9.54 12.42-9.54 2.64 0 4.02.6 4.62.96v-4.32c0-3.42-1.32-5.1-4.44-5.1-3.66 0-4.8 2.4-3.96 5.7l-7.02-.78c-1.56-6.84 4.2-9.72 11.4-9.72 7.98 0 11.34 3.48 11.34 9.9v13.26c0 1.38.36 2.04 1.2 2.04 1.08 0 1.92-.96 1.92-.96l.42 5.22s-2.04 1.5-4.92 1.5c-2.94 0-4.98-1.5-5.46-4.62-1.56 2.94-4.56 4.92-8.46 4.92-5.16 0-9.06-3.48-9.06-8.46zm11.28 3.18c2.46 0 4.26-1.38 5.76-3.06v-5.16c-.6 0-1.38-.06-2.34-.06-4.8 0-7.44 1.44-7.44 4.62 0 2.46 1.62 3.66 4.02 3.66zM120.96 52V22.18h5.58l1.02 5.52c1.2-3.18 3.6-6.24 8.1-6.24 6.24 0 7.62 6.66 5.7 11.28l-6.3.84c.84-2.4.96-6-2.04-6-2.64 0-3.96 2.46-4.68 4.56V52h-7.38zm25.86 0V22.18h5.58l.9 4.86c2.22-3.24 4.68-5.58 9.36-5.58 5.04 0 8.88 2.82 8.88 9.18V52h-7.38V32.08c0-3.24-1.2-4.68-3.96-4.68-2.64 0-4.44 1.26-6 2.88V52h-7.38zm47.46-34.86V11.5h17.46v28.8c0 7.5-4.2 12.42-12.18 12.42-8.52 0-13.14-5.52-10.98-13.5l6.84-.72c-1.26 5.16-.06 8.4 3.96 8.4 3.06 0 4.62-1.92 4.62-5.58V17.14h-9.72zm23.94 22.62l6.9-.72c-1.08 4.26 1.2 7.98 8.1 7.98 5.46 0 7.2-2.4 7.2-5.16 0-3.66-3.3-5.04-8.04-6.66-5.76-1.98-13.44-4.38-13.44-12.84 0-7.2 5.52-11.7 14.88-11.58 11.04.12 14.94 6.42 13.74 13.32l-7.32.72c.78-5.76-1.56-8.46-6.96-8.46-4.56 0-6.54 2.04-6.54 5.04 0 4.02 3.72 5.34 8.4 6.9 6.06 1.98 13.02 4.32 13.02 12.36 0 6.84-5.1 12.06-15.24 12.06-9.48 0-16.08-4.5-14.7-12.96z"
      fill="#000"
      fill-rule="nonzero"
    />
  </g>
</svg>
</a>
          <button data-type="secondary" data-js="menu-button">Menu</button>
        </div>
        <div>
          <a href="../index.html">Contents</a>
          <a href="../../components/index.html">Components</a>
          <a href="../../community/index.html">Community</a>
          <a href="../../extras/index.html">Extras</a>
        </div>
        <div>
          <a href="../..https://nerd-dir.com">Account</a>
          <button data-type="secondary" data-js="logout">OpenDir</button>
        </div>
      </nav>

    <noscript>
      <div class="wrap">
        This portal uses JavaScript to check your identity. Please enable JavaScript to access the course.
      </div>
    </noscript>

    <main>
      <div class="wrap">
<div
  data-js="check-auth"
  data-required-authorization="mastery"
  data-auth-state="failure"
>
  <article class="longform" data-failed-content>
    <h1>üõ†Ô∏è Popover: Adding event listeners</h1>
    <p>Hey <span data-js="user-data" data-field="firstName">,</p>
      <p>
      I'm thrilled to help you learn JavaScript. Unfortunately, you've landed on a page where you cannot access with your current purchase.
    </p>
      <p>
      Please upgrade (<a href="../../404/index.html" data-upgrade-link
        >use this link</a
      >) access this content.
    </p>

      <p>I'm super eager to help you learn more!</p>
    </article>

    <article class="longform" data-content>
      <h1>üõ†Ô∏è Popover: Adding event listeners</h1>



      <div class="meta source-code">


    <a href="../../download/components/popover/09.library-2.zip">
      <svg class="icon" viewBox="0 0 20 20" height="1em">
        <path fill="currentColor" d="M.7 9.3l4.8-4.8 1.4 1.42L2.84 10l4.07 4.07-1.41 1.42L0 10l.7-.7zm18.6 1.4l.7-.7-5.49-5.49-1.4 1.42L17.16 10l-4.07 4.07 1.41 1.42 4.78-4.78z"/>
      </svg>
      <span>Source</span>
    </a>
      </div><p>We ended the previous lesson by ‚Äúbreaking‚Äù the Popover. If you clicked on each popover trigger right now, nothing happens.</p>
<video autoplay loop>
  <source src="../../images/components/popover/library/break.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/popover/library/break.mp4"> here </a> instead.
</video>
<p>Why? That‚Äôs because we haven‚Äôt added event listeners to show the popovers!</p>
<p>Let‚Äôs fix this by adding event listeners.</p>
<h2 id="adding-event-listeners">Adding event listeners</h2>
<p>We have a total of five event listeners:</p>
<ol>
<li>One to show/hide popovers when users click on their corresponding trigger elements.</li>
<li>One to hide popovers when users click outside a popover</li>
<li>One to tab into popovers</li>
<li>One to tab out of popovers</li>
<li>One to close popovers with the escape key</li>
</ol>
<p>We‚Äôll work on #1, #3, #4, #5, then back to #2. I saved #2 for the last because it‚Äôs a little more complicated than the rest.</p>
<h2 id="showing%2Fhiding-popovers">Showing/Hiding Popovers</h2>
<p>Here‚Äôs the event listener we used to show and hide popovers when a user clicks a trigger element.</p>
<pre><code class="language-js">document.addEventListener('click', event =&gt; {
  const popoverTrigger = event.target.closest('.popover-trigger')
  if (!popoverTrigger) return

  const popover = document.querySelector(`#${popoverTrigger.dataset.target}`)
  if (popover.hasAttribute('hidden')) {
    showPopover(popover)
  } else {
    hidePopover(popover)
  }
})
</code></pre>
<p>We can add this event listener into <code>Popover</code> after the <code>Execution</code> phase.</p>
<pre><code class="language-js">export default function Popover (triggerElement) {
  // ...
  // Execution
  const popoverPosition = popover.calculatePosition()
  popoverElement.style.top = `${popoverPosition.top}px`
  popoverElement.style.left = `${popoverPosition.left}px`
  popover.hide()

  // Adding event listeners
  document.addEventListener('click', event =&gt; {
    const popoverTrigger = event.target.closest('.popover-trigger')
    if (!popoverTrigger) return

    const popover = document.querySelector(`#${popoverTrigger.dataset.target}`)
    if (popover.hasAttribute('hidden')) {
      showPopover(popover)
    } else {
      hidePopover(popover)
    }
  })
}
</code></pre>
<p>We can use a named callback to make the event listener easier to read. We‚Äôll call this <code>handleClick</code> since the purpose of this event listener is to handle a <code>click</code> event.</p>
<pre><code class="language-js">export default function Popover (triggerElement) {
  // ...

  const popover = {
    handleClick(event) {
      // Event listener code goes here
    }
  }

  // ...

  // Adding event listeners
  document.addEventListener('click', popover.handleClick)
}
</code></pre>
<h3 id="improving-the-event-listener">Improving the event listener</h3>
<p>Here‚Äôs the code for the event listener right now:</p>
<pre><code class="language-js">const popover = {
  // ...
  handleClick (event) {
    const popoverTrigger = event.target.closest('.popover-trigger')
    if (!popoverTrigger) return

    const popover = document.querySelector(`#${popoverTrigger.dataset.target}`)
    if (popover.hasAttribute('hidden')) {
      showPopover(popover)
    } else {
      hidePopover(popover)
    }
  }
}
</code></pre>
<p>In the first two lines of <code>handleClick</code>, we searched for the popover trigger from the event. We need to perform this search because we listened to the <code>document</code> element.</p>
<p>We can skip the search if we listened to the trigger element instead ‚Äì if the callback triggers, we know the user click the trigger element. This method creates more event listeners in the document, but it makes it easier to write code event handlers.</p>
<pre><code class="language-js">export default function Popover () {
  // ...
	const popover = {
	  // ...
	  handleClick (event) {
	    // Delete these lines
	    const popoverTrigger = event.target.closest('.popover-trigger')
	    if (!popoverTrigger) return
	  }
	}

	triggerElement.addEventListener('click', popover.handleClick)
}
</code></pre>
<p>In the next line of <code>handleClick</code>, we tried to find <code>popover</code> with the trigger element. We don‚Äôt need to find <code>popover</code> anymore because we have <code>popoverElement</code>  in the lexical scope.</p>
<pre><code class="language-js">const popover = {
  // ...
  handleClick (event) {
    // Delete this
    const popover = document.querySelector(`#${popoverTrigger.dataset.target}`)
  }
}
</code></pre>
<p>So all we need inside <code>handleClick</code> is this:</p>
<pre><code class="language-js">const popover = {
  // ...
  handleClick (event) {
    if (popover.hasAttribute('hidden')) {
      showPopover(popover)
    } else {
      hidePopover(popover)
    }
  }
}
</code></pre>
<p>We already added <code>hidePopover</code> in the previous lesson. We named it <code>hide</code>.</p>
<pre><code class="language-js">const popover = {
  // ...
  handleClick (event) {
    if (popover.hasAttribute('hidden')) {
      showPopover(popover)
    } else {
      popover.hide()
    }
  }
}
</code></pre>
<p>We can add <code>showPopover</code> to <code>Popover</code> the same way we added <code>hidePopover</code>. We‚Äôll name it <code>show</code>.</p>
<pre><code class="language-js">const popover = {
  // ...
  show () {
    popoverElement.removeAttribute('hidden')
  },

  handleClick (event) {
    if (popoverElement.hasAttribute('hidden')) {
      popover.show()
    } else {
      popover.hide()
    }
  }
}
</code></pre>
<p>Since <code>if/else</code> statements add cognitive overhead when reading code, we can make things more concise by using a ternary operator.</p>
<pre><code class="language-js">const popover = {
  // ...
	handleClick (event) {
	  popoverElement.hasAttribute('hidden')
	    ? popover.show()
	    : popover.hide()
	}
}
</code></pre>
<p>That‚Äôs it! Let‚Äôs work on the next event listener.</p>
<h2 id="listening-to-the-tab-key">Listening to the Tab key</h2>
<p>The next two events handle tabbing into and out of Popovers. They both use the <code>Tab</code> key.</p>
<pre><code class="language-js">// Allows Tabbing into Popover
document.addEventListener('keydown', event =&gt; {
  const { key } = event
  if (key !== 'Tab') return
  if (event.shiftKey) return

  const popoverTrigger = event.target.closest('.popover-trigger')
  if (!popoverTrigger) return

  const popover = getPopover(popoverTrigger)
  const focusables = getKeyboardFocusableElements(popover)
  const shouldTabIntoPopover = !popover.hasAttribute('hidden') &amp;&amp; focusables.length !== 0

  if (shouldTabIntoPopover) {
    event.preventDefault()
    focusables[0].focus()
  }
})

// Tabs out of popover
document.addEventListener('keydown', event =&gt; {
  const popover = event.target.closest('.popover')
  if (!popover) return
  if (event.key !== 'Tab') return

  const popoverTrigger = getPopoverTrigger(popover)
  const focusables = getKeyboardFocusableElements(popover)

  if (event.shiftKey &amp;&amp; event.target === focusables[0]) {
    event.preventDefault()
    return popoverTrigger.focus()
  }

  if (!event.shiftKey &amp;&amp; event.target === focusables[focusables.length - 1]) {
    return popoverTrigger.focus()
  }
})
</code></pre>
<p>We can create these events in <code>Popover</code> like this:</p>
<pre><code class="language-js">export default function Popover (triggerElement) {
  // ...
  document.addEventListener('keydown', handleTriggerTab)
  document.addEventListener('keydown', handlePopoverTab)
}
</code></pre>
<h3 id="creating-handletriggertab">Creating handleTriggerTab</h3>
<p>Here‚Äôs the code we wrote to handle a <code>Tab</code> on the trigger element.</p>
<pre><code class="language-js">document.addEventListener('keydown', event =&gt; {
  const { key } = event
  if (key !== 'Tab') return
  if (event.shiftKey) return

  const popoverTrigger = event.target.closest('.popover-trigger')
  if (!popoverTrigger) return

  const popover = getPopover(popoverTrigger)
  const focusables = getKeyboardFocusableElements(popover)
  const shouldTabIntoPopover = !popover.hasAttribute('hidden') &amp;&amp; focusables.length !== 0

  if (shouldTabIntoPopover) {
    event.preventDefault()
    focusables[0].focus()
  }
})
</code></pre>
<p>We can omit the following lines:</p>
<ul>
<li>Lines 4 and 5 because we have <code>triggerElement</code> in the lexical scope.</li>
<li>Lines 6 because we have <code>popoverElement</code> in the lexical scope.</li>
</ul>
<p>We should have this removing the code I mentioned:</p>
<pre><code class="language-js">const popover = {
  // ...
  handleTriggerTab (event) {
	  const { key } = event
	  if (key !== 'Tab') return
	  if (event.shiftKey) return

    const focusables = getKeyboardFocusableElements(popoverElement)
	  const shouldTabIntoPopover = !popoverElement.hasAttribute('hidden') &amp;&amp; focusables.length !== 0

	  if (shouldTabIntoPopover) {
	    event.preventDefault()
	    focusables[0].focus()
	  }
  }
}
</code></pre>
<p>When I read through this code, I felt that <code>shouldTabIntoPopover</code> is way too complicated. Since we had two conditions that must be matched, we can make things easier by checking for one condition at a time.</p>
<p>First, we check whether <code>popoverElement</code> is visible. If it is not visible, we will do an early return since its impossible for users to tab into the Popover.</p>
<pre><code class="language-js">const popover = {
  // ...
  handleTriggerTab (event) {
    const { key } = event
	  if (key !== 'Tab') return
	  if (event.shiftKey) return

		const focusables = getKeyboardFocusableElements(popoverElement)

    if (popoverElement.hasAttribute('hidden')) return
  }
}
</code></pre>
<p>Next, if the popover contains 0 focusable elements, we don‚Äôt let users tab into it as well. We can do another early return.</p>
<pre><code class="language-js">const popover = {
  // ...
  handleTriggerTab (event) {
    // ...
    if (popoverElement.hasAttribute('hidden')) return
    if (focusables.length === 0) return
  }
}
</code></pre>
<p>Finally, we let users tab into the popover.</p>
<pre><code class="language-js">const popover = {
  // ...
  handleTriggerTab (event) {
    // ...
    event.preventDefault()
    focusables[0].focus()
  }
}
</code></pre>
<h3 id="getkeyboardfocusableelements">getKeyboardFocusableElements</h3>
<p><code>handleTriggerTab</code> needs <code>getKeyboardFocusableElements</code> to work. I choose to put <code>getKeyboardFocusableElements</code> outside <code>Popover</code> since it‚Äôs more of a helper function than a <code>Popover</code> related code.</p>
<pre><code class="language-js">export default function Popover (triggerElement) {
  // ...
}

function getKeyboardFocusableElements() {
  // ...
}
</code></pre>
<h3 id="writing-handlepopovertab">Writing handlePopoverTab</h3>
<p>The next event listener handles tabbing out of a Popover. Here‚Äôs the code:</p>
<pre><code class="language-js">document.addEventListener('keydown', event =&gt; {
  const popover = event.target.closest('.popover')
  if (!popover) return
  if (event.key !== 'Tab') return

  const popoverTrigger = getPopoverTrigger(popover)
  const focusables = getKeyboardFocusableElements(popover)

  if (event.shiftKey &amp;&amp; event.target === focusables[0]) {
    event.preventDefault()
    return popoverTrigger.focus()
  }

  if (!event.shiftKey &amp;&amp; event.target === focusables[focusables.length - 1]) {
    return popoverTrigger.focus()
  }
})
</code></pre>
<p>We can omit the following lines:</p>
<ul>
<li>Lines 1 and 2 because we have <code>popoverElement</code> in the lexical scope</li>
<li>Line 4 because we have <code>triggerElement</code> in the lexical scope.</li>
</ul>
<p>Here‚Äôs what we have after omitting the lines above:</p>
<pre><code class="language-js">const popover {
	handlePopoverTab (event) {
	  if (event.key !== 'Tab') return
	  const focusables = getKeyboardFocusableElements(popoverElement)

	  if (event.shiftKey &amp;&amp; event.target === focusables[0]) {
	    event.preventDefault()
	    return triggerElement.focus()
	  }

	  if (!event.shiftKey &amp;&amp; event.target === focusables[focusables.length - 1]) {
	    return triggerElement.focus()
	  }
  }
}
</code></pre>
<h2 id="handling-the-escape-key">Handling the Escape key</h2>
<p>We have an event listener that listens to the <code>Escape</code> key.</p>
<pre><code class="language-js">// Escape to close popover
document.addEventListener('keydown', event =&gt; {
  const { key } = event
  if (key !== 'Escape') return

  const popover = event.target.closest('.popover')
  if (!popover) return

  hidePopover(popover)
  const popoverTrigger = getPopoverTrigger(popover)
  popoverTrigger.focus()
})
</code></pre>
<p>This event listener closes the popover when users press <code>Escape</code> inside the Popover. Let‚Äôs copy-paste this into the Popover.</p>
<pre><code class="language-js">export default function Popover () {
  // ...
  document.addEventListener('keydown',  event =&gt; {
	  const { key } = event
	  if (key !== 'Escape') return

	  const popover = event.target.closest('.popover')
	  if (!popover) return

	  hidePopover(popover)
	  const popoverTrigger = getPopoverTrigger(popover)
	  popoverTrigger.focus()
	})
}
</code></pre>
<p>Here are a few improvements:</p>
<ul>
<li>We can omit <code>popover</code> because we already have <code>popoverElement</code> in the lexical scope.</li>
<li>We can omit <code>popoverTrigger</code> because we have <code>triggerElement</code> in the lexical scope.</li>
<li>We can use <code>popover.hide</code> instead of <code>hidePopover(popover)</code></li>
</ul>
<pre><code class="language-js">export default function Popover () {
  // ...
  document.addEventListener('keydown',  event =&gt; {
	  const { key } = event
	  if (key !== 'Escape') return

    popover.hide()
    triggerElement.focus()
	})
}
</code></pre>
<p>One final thing. We only only want to hide the popover if users press <code>Escape</code> inside the popover element. We can do this by listening to <code>popoverElement</code> instead of <code>document</code>. If we used <code>document</code>, we need to use a <code>closest</code> check to make sure we‚Äôre on the right popover.</p>
<pre><code class="language-js">export default function Popover () {
  // ...
  popoverElement.addEventListener('keydown',  event =&gt; {
	  const { key } = event
	  if (key !== 'Escape') return

    popover.hide()
    triggerElement.focus()
	})
}
</code></pre>
<p>We can put the entire callback into a named function:</p>
<pre><code class="language-js">export default function Popover (triggerElement) {
  // ...
  const popover = {
    // ...
    handleEscapeKey (event) {
      // Paste the callback here
    }
  }

  // ...
  popoverElement.addEventListener('keydown', popover.handleEscapeKey)
}
</code></pre>
<h2 id="clicking-outside-the-popover">Clicking outside the popover</h2>
<p>There‚Äôs one more event listener to work with. This one closes all popover elements if the clicked target is:</p>
<ol>
<li>Not a popover</li>
<li>Not a trigger</li>
</ol>
<pre><code class="language-js">document.addEventListener('click', event =&gt; {
  if (!event.target.closest('.popover') &amp;&amp; !event.target.closest('.popover-trigger')) {
    const popovers = [...document.querySelectorAll('.popover')]
    popovers.forEach(popover =&gt; hidePopover(popover))
  }
})
</code></pre>
<p>There are two ways to write this code:</p>
<h3 id="method-1">Method 1</h3>
<p>The first way is to copy the code into <code>Popover</code>. If we do this, we create one event listener for every popover instance.</p>
<pre><code class="language-js">export default function Popover () {
  // ...
	document.addEventListener('click', event =&gt; {
	  if (!event.target.closest('.popover') &amp;&amp; !event.target.closest('.popover-trigger')) {
	    const popovers = [...document.querySelectorAll('.popover')]
	    popovers.forEach(popover =&gt; hidePopover(popover))
	  }
	})
}
</code></pre>
<figure role="figure" aria-label="We added 4 event listeners into the DOM">
  <img src="../../images/components/popover/library/event-listener-evidence.png" alt="">
  <figcaption>We added 4 event listeners into the DOM</figcaption>
</figure>
<p>Duplicated event listeners can be a source of problems if left unchecked.</p>
<p>For example, let‚Äôs say you have an event listener that opens or closes a window. If the user clicks once, you open the window. If the user clicks twice, you close the window. In this case, if you had two event listeners running at the same time listeners, you‚Äôll always close the window (because both event listeners will fire).</p>
<p>We can prevent duplicated event listeners by pointing browsers to the same callback handler. This means we have to create a named callback outside of <code>Popover</code>.</p>
<pre><code class="language-js">export default function Popover () {
  // ...
	document.addEventListener('click', closeAllPopovers)
}

function closeAllPopovers (event) {
  if (
    !event.target.closest('.popover') &amp;&amp; !event.target.closest('.popover-trigger')
  ) {
		const popovers = [...document.querySelectorAll('.popover')]
		popovers.forEach(popover =&gt; hidePopover(popover))
  }
}
</code></pre>
<p>Notice we need <code>hidePopover</code>? We cannot use <code>popover.hide</code> because it works only on an instance.</p>
<p>If we want to use <code>popover.hide</code> we need to keep track of all available popover instances in an array. Then, we loop through this array to hide the popovers.</p>
<p>We can do this in three steps.</p>
<p>First, We create the <code>popovers</code> array</p>
<pre><code class="language-js">// popover.js
const popovers = []
</code></pre>
<p>Second, we add each popover instance to <code>popovers</code> when we create them.</p>
<pre><code class="language-js">export default function Popover (triggerElement) {
  // ...
  // Execution

  // Add popover to popovers array
  popovers.push(popover)

  // Event listeners
}
</code></pre>
<p>Third, we loop through the <code>popovers</code> array and hide each popover.</p>
<pre><code class="language-js">export default function Popover () {
  // ...
	document.addEventListener('click', closeAllPopovers)
}

function closeAllPopovers (event) {
  if (
    !event.target.closest('.popover') &amp;&amp; !event.target.closest('.popover-trigger')
  ) {
		popovers.forEach(popover =&gt; popover.hide())
  }
}
</code></pre>
<h3 id="method-2">Method 2</h3>
<p>The method above is the ‚Äúmost technically correct‚Äù way to create global event listeners for multiple instances. But it can be complicated if you‚Äôre not used to it.</p>
<p>If you don‚Äôt have lots of instances on the same page, performance doesn‚Äôt really suffer, so we can use an alternate method to close popovers.</p>
<p>In this case, we‚Äôll add the event listener inside <code>Popover</code>.</p>
<pre><code class="language-js">export default function Popover () {
  // ...
	document.addEventListener('click', event =&gt; {
	  // ...
	})
}
</code></pre>
<p>We can then check whether the event target is within <code>popoverElement</code> or <code>triggerElement</code>. If they aren‚Äôt in any element, we hide the popover.</p>
<pre><code class="language-js">export default function Popover () {
  // ...
	document.addEventListener('click', event =&gt; {
    const target = event.target
    if (
      target.closest('.popover') !== popoverElement &amp;&amp;
      target.closest('button') !== triggerElement
    ) {
      console.log('hello')
      popover.hide()
    }
	})
}
</code></pre>
<p>This creates an effect where only one popover can be active at one time.</p>
<video autoplay loop>
  <source src="../../images/components/popover/library/one-open.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/popover/library/one-open.mp4"> here </a> instead.
</video>
<p>That‚Äôs it!</p>
</article>
  </div>



  <div class="longform">
    <nav class="lesson-nav">

          <a href="../popover-library/index.html" data-link-to="previous-lesson">
              <svg height="1em" viewbox="0 0 22 38">
                <path
          fill="currentColor"
          d="M18.9 38l3.1-3.1L6.1 19 22 3.1 18.9 0 0 19z"
        ></path>
              </svg>
              <span>üõ†Ô∏è Popover: Library</span>
            </a>
          <a href="../typeahead-library/index.html" data-link-to="next-lesson">
              <span>üõ†Ô∏è Typeahead: Library</span>
              <svg height="1em" viewbox="0 0 22 38">
                <path
          fill="currentColor"
          d="M3.1 0L0 3.1 15.9 19 0 34.9 3.1 38 22 19z"
        ></path>
              </svg>
            </a>
          </nav>
  </div>
</div>
    </main>



      <script module src="../../js/main-b9439821d7.mjs"></script>
      <script nomodule src="../../js/main-legacy-8c54230a8f.js"></script>
  </body>

<!-- /popover-library-event-listeners/  Mon, 24 Jan 2022 10:07:39 GMT -->
</html>
