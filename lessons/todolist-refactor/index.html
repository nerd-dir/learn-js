<!DOCTYPE html>
<html lang="en" class="no-js">

<!-- /todolist-refactor/  Mon, 24 Jan 2022 10:04:16 GMT -->
<!-- OpenDir --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /OpenDir -->
<head>
    <meta charset="UTF-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>

<title>üõ†Ô∏è Todolist: Refactor | Learn JavaScript</title>
<meta name="description" content="Learn JavaScript student portal"/>
<link rel="canonical" href="index.html">


<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="../../favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicons/favicon-16x16.png">
<link rel="manifest" href="../../favicons/site.webmanifest">
<link rel="mask-icon" href="../../favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="../../favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#ffc40d">
<meta name="msapplication-config" content="../../favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- CSS -->
<link rel="stylesheet" href="../../css/styles-min-afc4baccb2.css">

<!-- Fonts -->
<script>
  (function (d) {
    var config = {
        kitId: 'gas0cwl',
        scriptTimeout: 3000,
        async: true
      },
      h = d.documentElement,
      t = setTimeout(function () {
        h.className = h
          .className
          .replace(/\bwf-loading\b/g, "") + " wf-inactive";
      }, config.scriptTimeout),
      tk = d.createElement("script"),
      f = false,
      s = d.getElementsByTagName("script")[0],
      a;
    h.className += " wf-loading";
    tk.src = 'https://use.typekit.net/' + config.kitId + '.js';
    tk.async = true;
    tk.onload = tk.onreadystatechange = function () {
      a = this.readyState;
      if (f || a && a != "complete" && a != "loaded")
        return;
      f = true;
      clearTimeout(t);
      try {
        Typekit.load(config)
      } catch (e) {}
    };
    s
      .parentNode
      .insertBefore(tk, s)
  })(document);
</script>

<script>
  document
    .documentElement
    .classList
    .remove('no-js')
</script>

</head>

  <body class="page">
      <nav class="main-nav" data-js="menu" data-state="closed">
        <div>
          <a href="../index.html"><svg
  class="logo"
  data-size="small"
  height="1em"
  viewbox="0 0 273 43"
  xmlns="http://www.w3.org/2000/svg"
>
  <g transform="translate(-1 -10)" fill="none" fill-rule="evenodd">
    <rect fill="#F8E201" x="31" y="11" width="217" height="42" />
    <path
      d="M5.21 44.261v-5.217c0-2.726-.706-4.418-3.902-5.076v-3.76c3.196-.705 3.901-2.209 3.901-4.841v-6.11c0-4.606 2.68-8.178 8.695-8.178h1.551v3.995c-3.948 0-5.546 1.645-5.546 5.264v4.23c0 3.196-.94 6.345-4.136 7.473 3.102 1.175 4.136 4.042 4.136 7.05v4.089c0 4.183 1.598 5.828 5.546 5.828v3.995h-1.55c-5.782 0-8.696-3.243-8.696-8.742zm263.967-5.217l.141 5.217c-.141 5.499-2.961 8.742-8.789 8.742h-1.551v-3.995c3.948 0 5.499-1.645 5.499-5.828v-4.089c0-3.008 1.081-5.875 4.183-7.05-3.196-1.128-4.183-4.277-4.183-7.473v-4.23c0-3.619-1.551-5.264-5.499-5.264v-3.995h1.551c5.969 0 8.648 3.572 8.648 8.178v6.11c0 2.632.705 4.136 3.901 4.841v3.76c-3.196.658-3.901 2.35-3.901 5.076z"
      fill="#000"
      fill-rule="nonzero"
    />
    <path
      d="M29.82 52V11.5h7.74v34.56h17.46V52h-25.2zM58.2 37.78c0-8.16 3.54-16.32 13.68-16.32 8.4 0 12.18 5.1 12.18 13.62 0 .96-.06 1.92-.12 3H65.76c.06 7.44 3 9.36 6.54 9.36 2.76 0 5.52-1.2 5.52-4.2 0-.24-.06-.48-.06-.78l6 .84c.06.3.06.66.06 1.02 0 5.4-5.28 8.4-11.76 8.4-8.04 0-13.86-4.62-13.86-14.94zm13.62-11.7c-2.76 0-5.04 2.04-5.82 7.5h10.56v-1.02c0-3.48-1.38-6.48-4.74-6.48zM88.2 44.26c0-6.36 6.06-9.54 12.42-9.54 2.64 0 4.02.6 4.62.96v-4.32c0-3.42-1.32-5.1-4.44-5.1-3.66 0-4.8 2.4-3.96 5.7l-7.02-.78c-1.56-6.84 4.2-9.72 11.4-9.72 7.98 0 11.34 3.48 11.34 9.9v13.26c0 1.38.36 2.04 1.2 2.04 1.08 0 1.92-.96 1.92-.96l.42 5.22s-2.04 1.5-4.92 1.5c-2.94 0-4.98-1.5-5.46-4.62-1.56 2.94-4.56 4.92-8.46 4.92-5.16 0-9.06-3.48-9.06-8.46zm11.28 3.18c2.46 0 4.26-1.38 5.76-3.06v-5.16c-.6 0-1.38-.06-2.34-.06-4.8 0-7.44 1.44-7.44 4.62 0 2.46 1.62 3.66 4.02 3.66zM120.96 52V22.18h5.58l1.02 5.52c1.2-3.18 3.6-6.24 8.1-6.24 6.24 0 7.62 6.66 5.7 11.28l-6.3.84c.84-2.4.96-6-2.04-6-2.64 0-3.96 2.46-4.68 4.56V52h-7.38zm25.86 0V22.18h5.58l.9 4.86c2.22-3.24 4.68-5.58 9.36-5.58 5.04 0 8.88 2.82 8.88 9.18V52h-7.38V32.08c0-3.24-1.2-4.68-3.96-4.68-2.64 0-4.44 1.26-6 2.88V52h-7.38zm47.46-34.86V11.5h17.46v28.8c0 7.5-4.2 12.42-12.18 12.42-8.52 0-13.14-5.52-10.98-13.5l6.84-.72c-1.26 5.16-.06 8.4 3.96 8.4 3.06 0 4.62-1.92 4.62-5.58V17.14h-9.72zm23.94 22.62l6.9-.72c-1.08 4.26 1.2 7.98 8.1 7.98 5.46 0 7.2-2.4 7.2-5.16 0-3.66-3.3-5.04-8.04-6.66-5.76-1.98-13.44-4.38-13.44-12.84 0-7.2 5.52-11.7 14.88-11.58 11.04.12 14.94 6.42 13.74 13.32l-7.32.72c.78-5.76-1.56-8.46-6.96-8.46-4.56 0-6.54 2.04-6.54 5.04 0 4.02 3.72 5.34 8.4 6.9 6.06 1.98 13.02 4.32 13.02 12.36 0 6.84-5.1 12.06-15.24 12.06-9.48 0-16.08-4.5-14.7-12.96z"
      fill="#000"
      fill-rule="nonzero"
    />
  </g>
</svg>
</a>
          <button data-type="secondary" data-js="menu-button">Menu</button>
        </div>
        <div>
          <a href="../index.html">Contents</a>
          <a href="../../components/index.html">Components</a>
          <a href="../../community/index.html">Community</a>
          <a href="../../extras/index.html">Extras</a>
        </div>
        <div>
          <a href="../..https://nerd-dir.com">Account</a>
          <button data-type="secondary" data-js="logout">OpenDir</button>
        </div>
      </nav>

    <noscript>
      <div class="wrap">
        This portal uses JavaScript to check your identity. Please enable JavaScript to access the course.
      </div>
    </noscript>

    <main>
      <div class="wrap">
<div
  data-js="check-auth"
  data-required-authorization="mastery"
  data-auth-state="failure"
>
  <article class="longform" data-failed-content>
    <h1>üõ†Ô∏è Todolist: Refactor</h1>
    <p>Hey <span data-js="user-data" data-field="firstName">,</p>
      <p>
      I'm thrilled to help you learn JavaScript. Unfortunately, you've landed on a page where you cannot access with your current purchase.
    </p>
      <p>
      Please upgrade (<a href="../../404/index.html" data-upgrade-link
        >use this link</a
      >) access this content.
    </p>

      <p>I'm super eager to help you learn more!</p>
    </article>

    <article class="longform" data-content>
      <h1>üõ†Ô∏è Todolist: Refactor</h1>



      <div class="meta source-code">


    <a href="../../download/components/todolist/14.refactor.zip">
      <svg class="icon" viewBox="0 0 20 20" height="1em">
        <path fill="currentColor" d="M.7 9.3l4.8-4.8 1.4 1.42L2.84 10l4.07 4.07-1.41 1.42L0 10l.7-.7zm18.6 1.4l.7-.7-5.49-5.49-1.4 1.42L17.16 10l-4.07 4.07 1.41 1.42 4.78-4.78z"/>
      </svg>
      <span>Source</span>
    </a>
      </div><p>It‚Äôs now a good time to do a refactor since we completed Optimistic UI for the Todolist. Let‚Äôs go through the code from top to bottom together. I‚Äôll only write the parts that we can refactor.</p>
<h2 id="updateconnectionstatus">updateConnectionStatus</h2>
<p>We wrote three lines of code to check whether the user is online or offline. The first <code>setConnectionStatus</code> tells us whether the user is offline when they load the site.</p>
<p>The other two lines update the connection status.</p>
<pre><code class="language-js">setConnectionStatus()
window.addEventListener('online', setConnectionStatus)
window.addEventListener('offline', setConnectionStatus)
</code></pre>
<p>Makes sense to group these three lines into a function.</p>
<pre><code class="language-js">function updateConnectionStatus () {
  setConnectionStatus()
  window.addEventListener('online', setConnectionStatus)
  window.addEventListener('offline', setConnectionStatus)
}
</code></pre>
<p>Although this is optional, we can put <code>setConnectionStatus</code> inside <code>updateConnectionStatus</code>. This makes it easier understand the code since <code>setConnectionStatus</code> is quite short anyway.</p>
<pre><code class="language-js">function updateConnectionStatus () {
  function setConnectionStatus () {
    // ...
  }

  setConnectionStatus()
  window.addEventListener('online', setConnectionStatus)
  window.addEventListener('offline', setConnectionStatus)
}
</code></pre>
<p>Using <code>updateConnectionStatus</code>:</p>
<pre><code class="language-js">updateConnectionStatus()
</code></pre>
<h2 id="simpler-error-messages">Simpler error messages</h2>
<p>We wrote this for error messages. The first part of the code formats the error message while the second part creates and adds an error element to the DOM.</p>
<pre><code class="language-js">// Format error message
let errorMessage = ''
const { message } = error.body
if (message === 'TypeError: Failed to fetch') {
  errorMessage = 'Failed to reach server. Please try again later.'
} else if (message === 'Unauthorized') {
  errorMessage = 'Invalid username or password. Please check your username or password.'
} else {
  errorMessage = error.body.message
}

// Create error element
const errorElement = makeErrorElement(errorMessage)

// Add error element to DOM
flashContainer.appendChild(errorElement)
</code></pre>
<p>We can group the first part into a function called <code>formatErrorMessage</code>. The function name clarifies what the code does.</p>
<pre><code class="language-js">const formatErrorMessage = _ =&gt; {
  // ...
}
</code></pre>
<p>First, we copy-paste the code into <code>formatErrorMessage</code>.</p>
<pre><code class="language-js">const formatErrorMessage = _ =&gt; {
  let errorMessage = ''
  const { message } = error.body
  if (message === 'TypeError: Failed to fetch') {
    errorMessage = 'Failed to reach server. Please try again later.'
  } else if (message === 'Unauthorized') {
    errorMessage = 'Invalid username or password. Please check your username or password.'
  } else {
    errorMessage = error.body.message
  }
}
</code></pre>
<p>Here, you can see we need a <code>message</code> from <code>error.body</code>. We can pass the message into this function directly.</p>
<pre><code class="language-js">const formatErrorMessage = message =&gt; {
  let errorMessage = ''
  if (message === 'TypeError: Failed to fetch') {
    errorMessage = 'Failed to reach server. Please try again later.'
  } else if (message === 'Unauthorized') {
    errorMessage = 'Invalid username or password. Please check your username or password.'
  } else {
    errorMessage = message
  }
}
</code></pre>
<p>We can also use early return statements to simplify the function.</p>
<pre><code class="language-js">const formatErrorMessage = message =&gt; {
  if (message === 'TypeError: Failed to fetch') {
    return 'Failed to reach server. Please try again later.'
  }

  if (message === 'Unauthorized') {
    return 'Invalid username or password. Please check your username or password.'
  }

  return message
}
</code></pre>
<p>Now the block of code for creating error messages become this:</p>
<pre><code class="language-js">// Format error message
const errorMessage = formatErrorMessage(error.body.message)

// Create error element
const errorElement = makeErrorElement(errorMessage)

// Add error element to DOM
flashContainer.appendChild(errorElement)
</code></pre>
<p>We can group these three lines of code into one function so we don‚Äôt have to write them multiple times.</p>
<p>We have a choice here. We can either:</p>
<ol>
<li>Put everything into <code>makeErrorElement</code></li>
<li>Create a new function to wrap these three lines.</li>
</ol>
<p>Both make sense. For me, I would put everything into <code>makeErrorElement</code>.</p>
<pre><code class="language-js">const makeErrorElement = message =&gt; {
  // Formats the error message first
  message = formatErrorMessage(message)

  // Create the error element
  const errorElement = document.createElement('div')
  errorElement.classList.add('flash')
  errorElement.dataset.type = 'error'
  errorElement.innerHTML = /*...*/

  // Append element to the DOM
  flashContainer.appendChild(errorElement)
}
</code></pre>
<p>With this, we do three things in <code>makeErrorElement</code>:</p>
<ol>
<li>Format the error message</li>
<li>Make the error element</li>
<li>Add the error element to the DOM</li>
</ol>
<p>The name ‚ÄúmakeErrorElement‚Äù doesn‚Äôt make sense anymore since it‚Äôs one of the three things. A better name would be <code>createErrorMessage</code>.</p>
<pre><code class="language-js">const createErrorMessage = message =&gt; {
  // Formats the error message first
  message = formatErrorMessage(message)

  // Create the error element
  const errorElement = document.createElement('div')
  errorElement.classList.add('flash')
  errorElement.dataset.type = 'error'
  errorElement.innerHTML = /*...*/

  // Append element to the DOM
  flashContainer.appendChild(errorElement)
}
</code></pre>
<p>You can now use <code>createErrorMessage</code> in every <code>catch</code> statement.</p>
<pre><code class="language-js">zlFetch(/*...*/)
  .then(/*...*/)
  .catch(error =&gt; {
    // ...
    createError(error.body.message)
  })
</code></pre>
<h2 id="showing-and-hiding-tasks">Showing and hiding tasks</h2>
<p>We had to write these three lines of code to show and hide our tasks:</p>
<pre><code class="language-js">// Show task
taskElement.removeAttribute('hidden')

// Hide task
taskElement.setAttribute('hidden', true)

// Check if task is hidden
taskElement.hasAttribute('hidden')
</code></pre>
<p>We‚Äôve done this many times now. Let‚Äôs create a function for each of these lines of code.</p>
<pre><code class="language-js">// Show task
function showTask (taskElement) {
  return taskElement.removeAttribute('hidden')
}

// Hide task
function hideTask (taskElement) {
  return taskElement.setAttribute('hidden', true)
}

// Check if task is hidden
function isTaskHidden (taskElement) {
  return taskElement.hasAttribute('hidden')
}
</code></pre>
<p>We can make these functions more generic since we always hide things with <code>hidden</code>. They can be used for any element.</p>
<pre><code class="language-js">// Show element
function showElement (element) {
  return element.removeAttribute('hidden')
}

// Hide element
function hideElement (element) {
  return element.setAttribute('hidden', true)
}

// Check if element is hidden
function isElementHidden (element) {
  return element.hasAttribute('hidden')
}
</code></pre>
<p>You should know how to use these by now :)</p>
<h2 id="simplifying-the-empty-state">Simplifying the empty state</h2>
<p>We showed the empty state with <code>every</code> and <code>if/else</code>. It looks quite complicated.</p>
<pre><code class="language-js">// Deleting tasks
taskList.addEventListener('click', event =&gt; {
  // ...
  const allTasksAreHidden = [...taskList.children]
    .every(element =&gt; {
      return element.hasAttribute('hidden')
    })

  if (allTasksAreHidden) {
    taskList.classList.add('is-empty')
  } else {
    taskList.classList.remove('is-empty')
  }

  // ...
})
</code></pre>
<p>What we‚Äôre doing here is:</p>
<ol>
<li>Check if we should show the empty state</li>
<li>If yes, show the empty state</li>
<li>If no, hide the empty state</li>
</ol>
<p>We can make this easier if we split the code up into three functions:</p>
<ol>
<li>A function to check if we should show the empty state</li>
<li>A function to show the empty state</li>
<li>A function to hide the empty state</li>
</ol>
<pre><code class="language-js">const shouldShowEmptyState = _ =&gt; { /*...*/ }
const showEmptyState = _ =&gt; { /*...*/ }
const hideEmptyState = _ =&gt; { /*...*/ }
</code></pre>
<h3 id="shouldshowemptystate">shouldShowEmptyState</h3>
<p>We need to check for two things to decide whether to show the empty state:</p>
<ol>
<li>Does the task list contain any elements?</li>
<li>Are all tasks hidden from view?</li>
</ol>
<p>First, we want to show the empty state if <code>taskList</code> contains no elements.</p>
<pre><code class="language-js">const shouldShowEmptyState = _ =&gt; {
  if (taskList.children.length === 0) return true
}
</code></pre>
<p>Second, if <code>taskList</code> contains elements, we want to check if they‚Äôre all hidden.</p>
<pre><code class="language-js">const shouldShowEmptyState = _ =&gt; {
  if (taskList.children.length === 0) return true
  return [...taskList.children].every(isElementHidden)
}
</code></pre>
<h3 id="showemptystate">showEmptyState</h3>
<p>We show the empty state by adding <code>.is-empty</code> to <code>taskList</code>.</p>
<pre><code class="language-js">const showEmptyState = _ =&gt; {
  taskList.classList.add('is-empty')
}
</code></pre>
<p>We need to check whether we should show the empty state when a user deletes a task. If yes, we‚Äôll use <code>showEmptyState</code> to show the empty state.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  hideElement(taskElement)
  if (shouldShowEmptyState()) showEmptyState()

  zlFetch.delete(/*...*)
})
</code></pre>
<p>If we get an error from the server while deleting tasks, we need to hide the empty state.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...

  zlFetch.delete(/*...*/)
    .catch(_ =&gt; {
      // ...
      showElement(taskElement)
      hideEmptyState()
    })
})
</code></pre>
<p>This brings us to <code>hideEmptyState</code>.</p>
<h3 id="hideemptystate">hideEmptyState</h3>
<p>We can hide the empty state by removing <code>.is-empty</code> from <code>taskList</code>.</p>
<pre><code class="language-js">const hideEmptyState = _ =&gt; {
  taskList.classList.remove('is-empty')
}
</code></pre>
<p>We need to hide the empty state when the following occurs:</p>
<ol>
<li>User deletes a task, but deletion is not successful (see above ‚òùÔ∏è).</li>
<li>User adds a task</li>
</ol>
<p>We‚Äôve done (1), so let‚Äôs on (2) now.</p>
<p>We need to hide the empty state when a user adds a task. This is because there‚Äôll always be at least one task in the DOM.</p>
<pre><code class="language-js">// Adding a task to the DOM
todolist.addEventListener('submit', event =&gt; {
  // ...
  taskList.appendChild(tempTaskElement)
  hideEmptyState()
  // ...
})
</code></pre>
<p>If the server responds with an error, we need to remove the added task. In this case, we need to check whether we should show the empty state. If yes, we show the empty state with <code>showEmptyState</code>.</p>
<pre><code class="language-js">// Adding a task to the DOM
todolist.addEventListener('submit', event =&gt; {
  // ...
  zlFetch.post(/*...*/)
    .then(/*...*/)
    .catch(error =&gt; {
      // ...
      taskList.removeChild(tempTaskElement)
      if (shouldShowEmptyState()) showEmptyState()
    })
})
</code></pre>
<p>That‚Äôs it!</p>
</article>
  </div>



  <div class="longform">
    <nav class="lesson-nav">

          <a href="../todolist-optimistic-ui-delete-tasks/index.html" data-link-to="previous-lesson">
              <svg height="1em" viewbox="0 0 22 38">
                <path
          fill="currentColor"
          d="M18.9 38l3.1-3.1L6.1 19 22 3.1 18.9 0 0 19z"
        ></path>
              </svg>
              <span>üõ†Ô∏è Todolist: Deleting tasks with Optimistic UI</span>
            </a>
          <a href="../typeahead-how-to-ajax/index.html" data-link-to="next-lesson">
              <span>üõ†Ô∏è Typeahead: How to add Ajax</span>
              <svg height="1em" viewbox="0 0 22 38">
                <path
          fill="currentColor"
          d="M3.1 0L0 3.1 15.9 19 0 34.9 3.1 38 22 19z"
        ></path>
              </svg>
            </a>
          </nav>
  </div>
</div>
    </main>



      <script module src="../../js/main-b9439821d7.mjs"></script>
      <script nomodule src="../../js/main-legacy-8c54230a8f.js"></script>
  </body>

<!-- /todolist-refactor/  Mon, 24 Jan 2022 10:04:17 GMT -->
</html>
