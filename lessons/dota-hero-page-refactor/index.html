<!DOCTYPE html>
<html lang="en" class="no-js">

<!-- /dota-hero-page-refactor/  Mon, 24 Jan 2022 10:04:48 GMT -->
<!-- OpenDir --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /OpenDir -->
<head>
    <meta charset="UTF-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>

<title>üõ†Ô∏è Dota Heroes: Heroes page refactor | Learn JavaScript</title>
<meta name="description" content="Learn JavaScript student portal"/>
<link rel="canonical" href="index.html">


<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="../../favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicons/favicon-16x16.png">
<link rel="manifest" href="../../favicons/site.webmanifest">
<link rel="mask-icon" href="../../favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="../../favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#ffc40d">
<meta name="msapplication-config" content="../../favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- CSS -->
<link rel="stylesheet" href="../../css/styles-min-afc4baccb2.css">

<!-- Fonts -->
<script>
  (function (d) {
    var config = {
        kitId: 'gas0cwl',
        scriptTimeout: 3000,
        async: true
      },
      h = d.documentElement,
      t = setTimeout(function () {
        h.className = h
          .className
          .replace(/\bwf-loading\b/g, "") + " wf-inactive";
      }, config.scriptTimeout),
      tk = d.createElement("script"),
      f = false,
      s = d.getElementsByTagName("script")[0],
      a;
    h.className += " wf-loading";
    tk.src = 'https://use.typekit.net/' + config.kitId + '.js';
    tk.async = true;
    tk.onload = tk.onreadystatechange = function () {
      a = this.readyState;
      if (f || a && a != "complete" && a != "loaded")
        return;
      f = true;
      clearTimeout(t);
      try {
        Typekit.load(config)
      } catch (e) {}
    };
    s
      .parentNode
      .insertBefore(tk, s)
  })(document);
</script>

<script>
  document
    .documentElement
    .classList
    .remove('no-js')
</script>

</head>

  <body class="page">
      <nav class="main-nav" data-js="menu" data-state="closed">
        <div>
          <a href="../index.html"><svg
  class="logo"
  data-size="small"
  height="1em"
  viewbox="0 0 273 43"
  xmlns="http://www.w3.org/2000/svg"
>
  <g transform="translate(-1 -10)" fill="none" fill-rule="evenodd">
    <rect fill="#F8E201" x="31" y="11" width="217" height="42" />
    <path
      d="M5.21 44.261v-5.217c0-2.726-.706-4.418-3.902-5.076v-3.76c3.196-.705 3.901-2.209 3.901-4.841v-6.11c0-4.606 2.68-8.178 8.695-8.178h1.551v3.995c-3.948 0-5.546 1.645-5.546 5.264v4.23c0 3.196-.94 6.345-4.136 7.473 3.102 1.175 4.136 4.042 4.136 7.05v4.089c0 4.183 1.598 5.828 5.546 5.828v3.995h-1.55c-5.782 0-8.696-3.243-8.696-8.742zm263.967-5.217l.141 5.217c-.141 5.499-2.961 8.742-8.789 8.742h-1.551v-3.995c3.948 0 5.499-1.645 5.499-5.828v-4.089c0-3.008 1.081-5.875 4.183-7.05-3.196-1.128-4.183-4.277-4.183-7.473v-4.23c0-3.619-1.551-5.264-5.499-5.264v-3.995h1.551c5.969 0 8.648 3.572 8.648 8.178v6.11c0 2.632.705 4.136 3.901 4.841v3.76c-3.196.658-3.901 2.35-3.901 5.076z"
      fill="#000"
      fill-rule="nonzero"
    />
    <path
      d="M29.82 52V11.5h7.74v34.56h17.46V52h-25.2zM58.2 37.78c0-8.16 3.54-16.32 13.68-16.32 8.4 0 12.18 5.1 12.18 13.62 0 .96-.06 1.92-.12 3H65.76c.06 7.44 3 9.36 6.54 9.36 2.76 0 5.52-1.2 5.52-4.2 0-.24-.06-.48-.06-.78l6 .84c.06.3.06.66.06 1.02 0 5.4-5.28 8.4-11.76 8.4-8.04 0-13.86-4.62-13.86-14.94zm13.62-11.7c-2.76 0-5.04 2.04-5.82 7.5h10.56v-1.02c0-3.48-1.38-6.48-4.74-6.48zM88.2 44.26c0-6.36 6.06-9.54 12.42-9.54 2.64 0 4.02.6 4.62.96v-4.32c0-3.42-1.32-5.1-4.44-5.1-3.66 0-4.8 2.4-3.96 5.7l-7.02-.78c-1.56-6.84 4.2-9.72 11.4-9.72 7.98 0 11.34 3.48 11.34 9.9v13.26c0 1.38.36 2.04 1.2 2.04 1.08 0 1.92-.96 1.92-.96l.42 5.22s-2.04 1.5-4.92 1.5c-2.94 0-4.98-1.5-5.46-4.62-1.56 2.94-4.56 4.92-8.46 4.92-5.16 0-9.06-3.48-9.06-8.46zm11.28 3.18c2.46 0 4.26-1.38 5.76-3.06v-5.16c-.6 0-1.38-.06-2.34-.06-4.8 0-7.44 1.44-7.44 4.62 0 2.46 1.62 3.66 4.02 3.66zM120.96 52V22.18h5.58l1.02 5.52c1.2-3.18 3.6-6.24 8.1-6.24 6.24 0 7.62 6.66 5.7 11.28l-6.3.84c.84-2.4.96-6-2.04-6-2.64 0-3.96 2.46-4.68 4.56V52h-7.38zm25.86 0V22.18h5.58l.9 4.86c2.22-3.24 4.68-5.58 9.36-5.58 5.04 0 8.88 2.82 8.88 9.18V52h-7.38V32.08c0-3.24-1.2-4.68-3.96-4.68-2.64 0-4.44 1.26-6 2.88V52h-7.38zm47.46-34.86V11.5h17.46v28.8c0 7.5-4.2 12.42-12.18 12.42-8.52 0-13.14-5.52-10.98-13.5l6.84-.72c-1.26 5.16-.06 8.4 3.96 8.4 3.06 0 4.62-1.92 4.62-5.58V17.14h-9.72zm23.94 22.62l6.9-.72c-1.08 4.26 1.2 7.98 8.1 7.98 5.46 0 7.2-2.4 7.2-5.16 0-3.66-3.3-5.04-8.04-6.66-5.76-1.98-13.44-4.38-13.44-12.84 0-7.2 5.52-11.7 14.88-11.58 11.04.12 14.94 6.42 13.74 13.32l-7.32.72c.78-5.76-1.56-8.46-6.96-8.46-4.56 0-6.54 2.04-6.54 5.04 0 4.02 3.72 5.34 8.4 6.9 6.06 1.98 13.02 4.32 13.02 12.36 0 6.84-5.1 12.06-15.24 12.06-9.48 0-16.08-4.5-14.7-12.96z"
      fill="#000"
      fill-rule="nonzero"
    />
  </g>
</svg>
</a>
          <button data-type="secondary" data-js="menu-button">Menu</button>
        </div>
        <div>
          <a href="../index.html">Contents</a>
          <a href="../../components/index.html">Components</a>
          <a href="../../community/index.html">Community</a>
          <a href="../../extras/index.html">Extras</a>
        </div>
        <div>
          <a href="../..https://nerd-dir.com">Account</a>
          <button data-type="secondary" data-js="logout">OpenDir</button>
        </div>
      </nav>

    <noscript>
      <div class="wrap">
        This portal uses JavaScript to check your identity. Please enable JavaScript to access the course.
      </div>
    </noscript>

    <main>
      <div class="wrap">
<div
  data-js="check-auth"
  data-required-authorization="mastery"
  data-auth-state="failure"
>
  <article class="longform" data-failed-content>
    <h1>üõ†Ô∏è Dota Heroes: Heroes page refactor</h1>
    <p>Hey <span data-js="user-data" data-field="firstName">,</p>
      <p>
      I'm thrilled to help you learn JavaScript. Unfortunately, you've landed on a page where you cannot access with your current purchase.
    </p>
      <p>
      Please upgrade (<a href="../../404/index.html" data-upgrade-link
        >use this link</a
      >) access this content.
    </p>

      <p>I'm super eager to help you learn more!</p>
    </article>

    <article class="longform" data-content>
      <h1>üõ†Ô∏è Dota Heroes: Heroes page refactor</h1>



      <div class="meta source-code">


    <a href="../../download/components/dota/08.hero-page-refactor.zip">
      <svg class="icon" viewBox="0 0 20 20" height="1em">
        <path fill="currentColor" d="M.7 9.3l4.8-4.8 1.4 1.42L2.84 10l4.07 4.07-1.41 1.42L0 10l.7-.7zm18.6 1.4l.7-.7-5.49-5.49-1.4 1.42L17.16 10l-4.07 4.07 1.41 1.42 4.78-4.78z"/>
      </svg>
      <span>Source</span>
    </a>
      </div><p>There are a couple of things we can do better in this code.</p>
<h2 id="concurrent-requests">Concurrent requests</h2>
<p>When searched for the hero‚Äôs abilities, we sent two fetch requests ‚Äì one after another.</p>
<pre><code class="language-javascript">zlFetch(`${dotaApi}/constants/abilities`)
  .then(response =&gt; {
    // ...
    zlFetch(`${dotaApi}/constants/hero_abilities`)
      .then(response =&gt; {
        // ..
      )}
  )}
</code></pre>
<p>The truth is, we don‚Äôt need to send these two requests separately. The second request doesn‚Äôt depend on the first one.</p>
<p>We can send them with <code>Promise.all</code>.</p>
<pre><code class="language-javascript">Promise.all([
  zlFetch(`${dotaApi}/constants/abilities`),
  zlFetch(`${dotaApi}/constants/hero_abilities`)
]).then(responses =&gt; {
  // ...
})
</code></pre>
<p><code>responses</code> here is an array of responses from the requests. The order of responses follows the order we wrote in <code>Promise.all</code>.</p>
<p>This means:</p>
<ul>
<li>First item is the response from the <code>abilities</code> endpoint.</li>
<li>Second item is the response from the <code>hero_abilities</code> endpoint.</li>
</ul>
<pre><code class="language-javascript">Promise.all([
  zlFetch(`${dotaApi}/constants/abilities`),
  zlFetch(`${dotaApi}/constants/hero_abilities`)
]).then(responses =&gt; {
  const allAbilities = responses[0].body
  const heroesAbilities = responses[1].body
})
</code></pre>
<p>We can then proceed with filtering, mapping, and inserting the hero‚Äôs abilities into the DOM.</p>
<pre><code class="language-javascript">Promise.all(/* ... */)
  .then(responses =&gt; {
    // ...

    const heroAbilities = heroesAbilities[`npc_dota_hero_${heroName}`]
      // ...
      .join('')

    heroAbilitiesEl.innerHTML = heroAbilities
    heroAbilitiesEl.closest('section').removeAttribute('hidden')
</code></pre>
<h2 id="why-not-wrap-all-fetch-requests-in-one-promise.all%3F">Why not wrap all fetch requests in one <code>Promise.all</code>?</h2>
<p>Good question! It certain makes sense to wrap all fetch requests into a single <code>Promise.all</code> function from a code point of view. This makes the code simpler and easier to maintain. But should we really do this?</p>
<p>When we are requesting for multiple resources at the same time, we need to think about how the content gets loaded. To do this, we look at the Network tab inside the Dev tools. You should see a list of the resources we requested.</p>
<figure role="figure">
  <img src="../../images/components/dota/hero-page-refactor/resources.png" alt="List of requested resources in the Network tab.">
</figure>
<p>I want you to pay special attention to the Waterfall column. This column tells us three things for each request:</p>
<ol>
<li>When the request is sent out (beginning of the green bar)</li>
<li>How long it took to receive a response (the green bar)</li>
<li>How long it took to download the data from the response (the blue bar)</li>
</ol>
<figure role="figure">
  <img src="../../images/components/dota/hero-page-refactor/waterfall.png" alt="Waterfall explanation.">
</figure>
<p>Notice this: The hero image‚Äôs request is sent out immediately after we receive information from the <code>heroes</code> endpoint.</p>
<figure role="figure">
  <img src="../../images/components/dota/hero-page-refactor/waterfall-no-wrap.png" alt="Image download starts immediately after heroes endpoint. ">
</figure>
<p>Wrapping requests together normally isn‚Äôt a huge problem because most requests are small. However, in this case, the <code>abilities</code> request is large. It is 1.13MB while the rest are approximately 100kb.</p>
<figure role="figure">
  <img src="../../images/components/dota/hero-page-refactor/abilities-size.png" alt="Size of the abilities response.">
</figure>
<p>If we wrap the requests together in <code>Promise.all</code>, we can only begin downloading the hero‚Äôs image after we finished downloading the data from the <code>abilities</code> response. This takes considerably longer, which means users have to wait longer for the page to be populated.</p>
<figure role="figure">
  <img src="../../images/components/dota/hero-page-refactor/waterfall-wrap.png" alt="Image download begins only after all four resources are fetched.">
</figure>
<p>If we want to improve loading performance, we have to perform separate fetch requests.</p>
<h2 id="minimizing-reflows">Minimizing Reflows</h2>
<p>Reflows refer to layout changes that causes content to jump. One of the tenets in web development is to minimise reflows so users have a better experience.</p>
<p>Our code right now produces up to three layers of reflows. This large amount of reflows is caused by the difference in loading time between different resources.</p>
<video autoplay loop>
  <source src="../../images/components/dota/hero-page-refactor/reflow.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/dota/hero-page-refactor/reflow.mp4"> here </a> instead.
</video>
<p>We need to consider the content-loading order to minisize reflows, so I want to turn your attention to the Network tab once again.</p>
<p>Here, you‚Äôll want to refresh the page and few times and see the order of requests and how the waterfall gets fulfilled.</p>
<p>I see the following patterns:</p>
<ol>
<li>The hero‚Äôs image takes more time to load compared to <code>hero_lore</code>. This slow loading time causes a reflow in the hero‚Äôs description.</li>
<li>Occasionally, abilities will load before lore, which causes the abilities section to reflow.</li>
</ol>
<h3 id="preventing-the-hero%E2%80%99s-description-from-reflowing">Preventing the hero‚Äôs description from reflowing</h3>
<p>There are two ways to prevent the hero‚Äôs description from reflowing:</p>
<ol>
<li>We fix the image‚Äôs width and height so the description doesn‚Äôt have to reflow.</li>
<li>We wait for the image to load before showing the hero‚Äôs description</li>
</ol>
<p>The first method is better since we reduce load time. It‚Äôs also easier to execute.</p>
<p>The hero‚Äôs image‚Äôs width and height is <code>256px</code> and <code>144px</code> respectively. We can set these values directly in the CSS.</p>
<pre><code class="language-javascript">.hero-page .hero__img {
  /* ... */
  width: 256px;
  height: 144px;
}
</code></pre>
<p>Once you set these values, you‚Äôll notice a border when the hero image isn‚Äôt loaded yet. This looks awful.</p>
<video autoplay loop>
  <source src="../../images/components/dota/hero-page-refactor/image-border.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/dota/hero-page-refactor/image-border.mp4"> here </a> instead.
</video>
<p>This border appears because the <code>src</code> attribute is empty. Browsers are treating the image as ‚Äúnot found‚Äù and showing a border to express this.</p>
<p>To prevent the border from showing up, we can insert a transparent image as the initial src.</p>
<pre><code class="language-javascript">&lt;h1 class=&quot;site-title&quot; data-hero-name&gt;&lt;/h1&gt;
&lt;img
  class=&quot;hero__img&quot;
  src=&quot;images/transparent.png&quot;
  data-hero-image
/&gt;
&lt;p data-hero-description&gt;&lt;/p&gt;
</code></pre>
<video autoplay loop>
  <source src="../../images/components/dota/hero-page-refactor/image-resolved.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/dota/hero-page-refactor/image-resolved.mp4"> here </a> instead.
</video>
<p>Note: A better choice is to provide a placeholder image for the Hero‚Äôs name, image, and description. This is called a skeleton screen. Here‚Äôs Facebook‚Äôs skeleton for a post.</p>
<figure role="figure">
  <img src="../../images/components/dota/hero-page-refactor/skeleton.png" alt="Facebook's skeleton">
</figure>
<p>You can find more about <a href="https://css-tricks.com/building-skeleton-screens-css-custom-properties/">skeleton screens here</a>.</p>
<h3 id="prevent-abilities-from-loading-before-description">Prevent abilities from loading before description</h3>
<p>Is this necessary? That‚Äôs the first question I always ask myself when creating features.</p>
<p>In this case, I suggest you don‚Äôt worry about preventing abilities from loading before the hero‚Äôs description because of two reasons:</p>
<ol>
<li>It doesn‚Äôt happen often.</li>
<li>Even if it happens, the reflow doesn‚Äôt really affect the user negatively.</li>
</ol>
<p>If you really wish to include this feature, you can send the request for abilities after you receive a response from the <code>hero_lore</code> endpoint.</p>
</article>
  </div>



  <div class="longform">
    <nav class="lesson-nav">

          <a href="../dota-hero-page-robust/index.html" data-link-to="previous-lesson">
              <svg height="1em" viewbox="0 0 22 38">
                <path
          fill="currentColor"
          d="M18.9 38l3.1-3.1L6.1 19 22 3.1 18.9 0 0 19z"
        ></path>
              </svg>
              <span>üõ†Ô∏è Dota Heroes: Making the hero page robust</span>
            </a>
          <a href="../keyboard-users/index.html" data-link-to="next-lesson">
              <span>Keyboard users</span>
              <svg height="1em" viewbox="0 0 22 38">
                <path
          fill="currentColor"
          d="M3.1 0L0 3.1 15.9 19 0 34.9 3.1 38 22 19z"
        ></path>
              </svg>
            </a>
          </nav>
  </div>
</div>
    </main>



      <script module src="../../js/main-b9439821d7.mjs"></script>
      <script nomodule src="../../js/main-legacy-8c54230a8f.js"></script>
  </body>

<!-- /dota-hero-page-refactor/  Mon, 24 Jan 2022 10:04:50 GMT -->
</html>
