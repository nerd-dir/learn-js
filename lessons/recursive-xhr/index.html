<!DOCTYPE html>
<html lang="en" class="no-js">

<!-- /recursive-xhr/  Mon, 24 Jan 2022 10:08:19 GMT -->
<!-- OpenDir --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /OpenDir -->
<head>
    <meta charset="UTF-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>

<title>Recursive XHR | Learn JavaScript</title>
<meta name="description" content="Learn JavaScript student portal"/>
<link rel="canonical" href="index.html">


<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="../../favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicons/favicon-16x16.png">
<link rel="manifest" href="../../favicons/site.webmanifest">
<link rel="mask-icon" href="../../favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="../../favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#ffc40d">
<meta name="msapplication-config" content="../../favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- CSS -->
<link rel="stylesheet" href="../../css/styles-min-afc4baccb2.css">

<!-- Fonts -->
<script>
  (function (d) {
    var config = {
        kitId: 'gas0cwl',
        scriptTimeout: 3000,
        async: true
      },
      h = d.documentElement,
      t = setTimeout(function () {
        h.className = h
          .className
          .replace(/\bwf-loading\b/g, "") + " wf-inactive";
      }, config.scriptTimeout),
      tk = d.createElement("script"),
      f = false,
      s = d.getElementsByTagName("script")[0],
      a;
    h.className += " wf-loading";
    tk.src = 'https://use.typekit.net/' + config.kitId + '.js';
    tk.async = true;
    tk.onload = tk.onreadystatechange = function () {
      a = this.readyState;
      if (f || a && a != "complete" && a != "loaded")
        return;
      f = true;
      clearTimeout(t);
      try {
        Typekit.load(config)
      } catch (e) {}
    };
    s
      .parentNode
      .insertBefore(tk, s)
  })(document);
</script>

<script>
  document
    .documentElement
    .classList
    .remove('no-js')
</script>

</head>

  <body class="page">
      <nav class="main-nav" data-js="menu" data-state="closed">
        <div>
          <a href="../index.html"><svg
  class="logo"
  data-size="small"
  height="1em"
  viewbox="0 0 273 43"
  xmlns="http://www.w3.org/2000/svg"
>
  <g transform="translate(-1 -10)" fill="none" fill-rule="evenodd">
    <rect fill="#F8E201" x="31" y="11" width="217" height="42" />
    <path
      d="M5.21 44.261v-5.217c0-2.726-.706-4.418-3.902-5.076v-3.76c3.196-.705 3.901-2.209 3.901-4.841v-6.11c0-4.606 2.68-8.178 8.695-8.178h1.551v3.995c-3.948 0-5.546 1.645-5.546 5.264v4.23c0 3.196-.94 6.345-4.136 7.473 3.102 1.175 4.136 4.042 4.136 7.05v4.089c0 4.183 1.598 5.828 5.546 5.828v3.995h-1.55c-5.782 0-8.696-3.243-8.696-8.742zm263.967-5.217l.141 5.217c-.141 5.499-2.961 8.742-8.789 8.742h-1.551v-3.995c3.948 0 5.499-1.645 5.499-5.828v-4.089c0-3.008 1.081-5.875 4.183-7.05-3.196-1.128-4.183-4.277-4.183-7.473v-4.23c0-3.619-1.551-5.264-5.499-5.264v-3.995h1.551c5.969 0 8.648 3.572 8.648 8.178v6.11c0 2.632.705 4.136 3.901 4.841v3.76c-3.196.658-3.901 2.35-3.901 5.076z"
      fill="#000"
      fill-rule="nonzero"
    />
    <path
      d="M29.82 52V11.5h7.74v34.56h17.46V52h-25.2zM58.2 37.78c0-8.16 3.54-16.32 13.68-16.32 8.4 0 12.18 5.1 12.18 13.62 0 .96-.06 1.92-.12 3H65.76c.06 7.44 3 9.36 6.54 9.36 2.76 0 5.52-1.2 5.52-4.2 0-.24-.06-.48-.06-.78l6 .84c.06.3.06.66.06 1.02 0 5.4-5.28 8.4-11.76 8.4-8.04 0-13.86-4.62-13.86-14.94zm13.62-11.7c-2.76 0-5.04 2.04-5.82 7.5h10.56v-1.02c0-3.48-1.38-6.48-4.74-6.48zM88.2 44.26c0-6.36 6.06-9.54 12.42-9.54 2.64 0 4.02.6 4.62.96v-4.32c0-3.42-1.32-5.1-4.44-5.1-3.66 0-4.8 2.4-3.96 5.7l-7.02-.78c-1.56-6.84 4.2-9.72 11.4-9.72 7.98 0 11.34 3.48 11.34 9.9v13.26c0 1.38.36 2.04 1.2 2.04 1.08 0 1.92-.96 1.92-.96l.42 5.22s-2.04 1.5-4.92 1.5c-2.94 0-4.98-1.5-5.46-4.62-1.56 2.94-4.56 4.92-8.46 4.92-5.16 0-9.06-3.48-9.06-8.46zm11.28 3.18c2.46 0 4.26-1.38 5.76-3.06v-5.16c-.6 0-1.38-.06-2.34-.06-4.8 0-7.44 1.44-7.44 4.62 0 2.46 1.62 3.66 4.02 3.66zM120.96 52V22.18h5.58l1.02 5.52c1.2-3.18 3.6-6.24 8.1-6.24 6.24 0 7.62 6.66 5.7 11.28l-6.3.84c.84-2.4.96-6-2.04-6-2.64 0-3.96 2.46-4.68 4.56V52h-7.38zm25.86 0V22.18h5.58l.9 4.86c2.22-3.24 4.68-5.58 9.36-5.58 5.04 0 8.88 2.82 8.88 9.18V52h-7.38V32.08c0-3.24-1.2-4.68-3.96-4.68-2.64 0-4.44 1.26-6 2.88V52h-7.38zm47.46-34.86V11.5h17.46v28.8c0 7.5-4.2 12.42-12.18 12.42-8.52 0-13.14-5.52-10.98-13.5l6.84-.72c-1.26 5.16-.06 8.4 3.96 8.4 3.06 0 4.62-1.92 4.62-5.58V17.14h-9.72zm23.94 22.62l6.9-.72c-1.08 4.26 1.2 7.98 8.1 7.98 5.46 0 7.2-2.4 7.2-5.16 0-3.66-3.3-5.04-8.04-6.66-5.76-1.98-13.44-4.38-13.44-12.84 0-7.2 5.52-11.7 14.88-11.58 11.04.12 14.94 6.42 13.74 13.32l-7.32.72c.78-5.76-1.56-8.46-6.96-8.46-4.56 0-6.54 2.04-6.54 5.04 0 4.02 3.72 5.34 8.4 6.9 6.06 1.98 13.02 4.32 13.02 12.36 0 6.84-5.1 12.06-15.24 12.06-9.48 0-16.08-4.5-14.7-12.96z"
      fill="#000"
      fill-rule="nonzero"
    />
  </g>
</svg>
</a>
          <button data-type="secondary" data-js="menu-button">Menu</button>
        </div>
        <div>
          <a href="../index.html">Contents</a>
          <a href="../../components/index.html">Components</a>
          <a href="../../community/index.html">Community</a>
          <a href="../../extras/index.html">Extras</a>
        </div>
        <div>
          <a href="../..https://nerd-dir.com">Account</a>
          <button data-type="secondary" data-js="logout">OpenDir</button>
        </div>
      </nav>

    <noscript>
      <div class="wrap">
        This portal uses JavaScript to check your identity. Please enable JavaScript to access the course.
      </div>
    </noscript>

    <main>
      <div class="wrap">
<div
  data-js="check-auth"
  data-required-authorization="mastery"
  data-auth-state="failure"
>
  <article class="longform" data-failed-content>
    <h1>Recursive XHR</h1>
    <p>Hey <span data-js="user-data" data-field="firstName">,</p>
      <p>
      I'm thrilled to help you learn JavaScript. Unfortunately, you've landed on a page where you cannot access with your current purchase.
    </p>
      <p>
      Please upgrade (<a href="../../404/index.html" data-upgrade-link
        >use this link</a
      >) access this content.
    </p>

      <p>I'm super eager to help you learn more!</p>
    </article>

    <article class="longform" data-content>
      <h1>Recursive XHR</h1>



      <div class="meta source-code">


      </div><p>Let’s say the API doesn’t tell you what the final page is. But you know you can get the next page through the <code>page</code> parameter.</p>
<p>If the API doesn’t send you any hints, you will need to make sequential requests, one by one. On each request, you check if there are more items to be sent. If there are, you request for more.</p>
<p>If there are no items, the server sends back an empty array.</p>
<pre><code></code></pre>
<p>For this example, I’m going to set <code>per_page</code> to <code>10</code> to create more pages for fetching.</p>
<p>You can do this with XHR or Fetch. I’m going to show you how to do it with XHR.</p>
<p>First, you send a request as normal.</p>
<pre><code class="language-js">const request = new XMLHttpRequest()
request.addEventListener('load', e =&gt; {
  let repos = JSON.parse(e.target.response)
})

request.open('get', 'https://api.github.com/users/zellwk/repos?per_page=20')
request.send()
</code></pre>
<p>Whether you send a second request depends on the number of items loaded. If less than ten times are sent back, you know there’s not more pages to request for. If the server sends you ten items, there’s a high chance that there are more items in the list.</p>
<pre><code class="language-js">const repos = JSON.parse(e.target.response)
if (repos.length === 10) {
  // Request for more resources
} else {
  // Do whatever you need with repos
}
</code></pre>
<p>To request for more resources, you need to create a second request. In this request, you need to set the <code>page</code> query parameter to 2.</p>
<pre><code class="language-js">if (repos.length === 10) {
  const request2 = new XMLHttpRequest()
  request2.addEventListener('load', e =&gt; {
    // Handle second request
  })
  request2.open('get', 'https://api.github.com/users/zellwk/repos?per_page=10&amp;page=2')
  request2.send()
} else {
  // Do whatever you need with repos
}
</code></pre>
<p>You want to join the repos together in the second request. This way, you have an array of all resources by the time you send the final request.</p>
<p>If there are 10 items in repos2, you’ll want to send another request. If not, you can start doing whatever you want.</p>
<pre><code class="language-js">const repos2 = JSON.parse(e.target.response)
repos = repos.concat(repos2)

if (repos2.length === 10) {
  // Make a third request
} else {
  // Do whatever you want
}
</code></pre>
<p>This process repeats itself until the server sends you less than 10 repositories. Since process repeats, we can create a function to request for every repository.</p>
<h3 id="creating-a-recursive-function">Creating a recursive function</h3>
<p>A recursive function is a function that calls itself until certain conditions are matched. It can be used to create something similar to a for-loop, and you can test for different things.</p>
<pre><code class="language-js">const recursiveRequest = _ =&gt; {
  const request = new XMLHttpRequest()
  request.addEventListener('load', e =&gt; {
    // Handle request
  })
  request.open('get', 'https://api.github.com/users/zellwk/repos?per_page=20')
  request.send()
}

recursiveRequest()
</code></pre>
<p>Change link variable.</p>
<pre><code class="language-js">const recursiveRequest = link =&gt; {
  const request = new XMLHttpRequest()
  request.addEventListener('load', e =&gt; { /* Handle request */})
  request.open('get', link)
  request.send()
}

recursiveRequest('https://api.github.com/users/zellwk/repos?per_page=20')
</code></pre>
<p>We know we’re going to make a lot of requests. We don’t want to write four lines of JavaScript per request. We can use a function to help us make requests.</p>
<pre><code class="language-js">const makeRequest = (link, callback) =&gt; {
  const request = new XMLHttpRequest()
  request.addEventListener('load', callback)
  request.open('get', link)
  request.send()
}
</code></pre>
<p>We can write our recursiveRequest request function as:</p>
<pre><code class="language-js">const recursiveRequest = link =&gt; {
  makeRequest(link, e =&gt; {
    // Handle request
  })
}
</code></pre>
<p>This is much easier to deal with. So let’s move on and attempt to handle an event. Our first event.</p>
<p>First, we need to parse the responses into to JSON.</p>
<pre><code class="language-js">const recursiveRequest = link =&gt; {
  makeRequest(link, e =&gt; {
    const requestedRepos = JSON.parse(e.target.response)
  })
}
</code></pre>
<p>Since we requested for some repos, we want to concatenate these repos to an initial repos array. This way, we can store our repos.</p>
<pre><code class="language-js">const recursiveRequest = (link, repos = []) =&gt; {
  makeRequest(link, e =&gt; {
    const requestedRepos = JSON.parse(e.target.response)
    repos = repos.concat(requestedRepos)
  })
}
</code></pre>
<p>If there are more than 20 repos, we want to make another request.</p>
<p>If there are less than 20 repos, we want to do something with the repos. To do something with the repos, we need to provide a callback since this function is asynchronous.</p>
<p>That means we need to provide a callback function to <code>recursiveRequest</code>.</p>
<pre><code class="language-js">const recursiveRequest = (link, callback, repos = []) =&gt; {
  makeRequest(link, e =&gt; {
    const requestedRepos = JSON.parse(e.target.response)
    repos = repos.concat(requestedRepos)

    if (requestedRepos.length === 20) {
      // make another request
    } else {
      callback(repos)
    }
  })
}
</code></pre>
<p>If there are more than twenty repos per page, we want to request for second page. Otherwise, we want to do something with the repos.</p>
<p>Next, we want to let the user determine how many items we’re fetching per page. We shouldn’t hard code 20. So need to give our function a <code>perPage</code> parameter.</p>
<pre><code class="language-js">const recursiveRequest = (link, perPage, callback, repos = []) =&gt; {
  makeRequest(link, e =&gt; {
    const requestedRepos = JSON.parse(e.target.response)
    repos = repos.concat(requestedRepos)

    if (requestRepos.length === perPage) {
      // make another request
    } else {
      callback(repos)
    }
  })
}

// Usage
recursiveRequest('some-link', 20, e =&gt; {/* Do something */})
</code></pre>
<p>Next, let’s make the next request. To make a second request, we need to run <code>makeRequest</code> again. This time, we need to provide different values. We need to set the <code>page</code> parameter to 2.</p>
<pre><code class="language-js">if (requestRepos.length === perPage) {
  makeRequest('some-link&amp;page=2', perPage, e =&gt; {/* Handle second request */}, repos)
}
</code></pre>
<p>Here’ we know that the event handle is exactly the same. We don’t want to call <code>makeRequest</code> again, because it only handles one request. Instead we want to call <code>recursiveRequest</code>, because it will make more requests until the repo count isn’t equal to the perPage variable.</p>
<pre><code class="language-js">if (requestRepos.length === perPage) {
  recursiveRequest(`${link}&amp;page=2,`, perPage, callback, repos)
}
</code></pre>
<p>But we need to change the link such that we’re fetching subsequent pages. That means we need a <code>page</code> variable. This variable can begin at page 1.</p>
<pre><code class="language-js">const recursiveRequest = (link, perPage, callback, repos = [], page = 1) =&gt; {
  makeRequest(link, e =&gt; {
    const requestedRepos = JSON.parse(e.target.response)
    repos = repos.concat(requestedRepos)

    if (requestRepos.length === perPage) {
      recursiveRequest(`${link}&amp;page=${page}`, perPage, callback, repos, page + 1)
    } else {
      callback(repos)
    }
  })
}

// Usage
recursiveRequest('some-link', 20, e =&gt; {/* Do something */})
</code></pre>
<p>Finally, five variables are too much. Let’s use convert our variables into an object so the recursiveRequest is easier to use. This way, we can organize our parameters in a way that makes sense without asking the user (us also, in this case) to worry about the order of parameters.</p>
<pre><code class="language-js">const makeRequest = (link, callback) =&gt; {
  const request = new XMLHttpRequest()
  request.addEventListener('load', callback)
  request.open('get', link)
  request.send()
}

const recursiveRequest = ({
  link,
  page = 1,
  perPage,
  callback,
  repos = []
} = {}) =&gt; {
  makeRequest(link, e =&gt; {
    const requestedRepos = JSON.parse(e.target.response)
    repos = repos.concat(requestedRepos)

    if (requestedRepos.length === perPage) {
      recursiveRequest({
        link: `${link}&amp;page=${page}`,
        page: page + 1,
        perPage,
        callback,
        repos
      })
    } else {
      callback(repos)
    }
  })
}

// Usage
recursiveRequest({
  link: 'https://api.github.com/users/zellwk/repos?per_page=20',
  perPage: 20,
  callback(repos) {
    console.log(repos)
  }
})
</code></pre>
</article>
  </div>



  <div class="longform">
    <nav class="lesson-nav">
      </nav>
  </div>
</div>
    </main>



      <script module src="../../js/main-b9439821d7.mjs"></script>
      <script nomodule src="../../js/main-legacy-8c54230a8f.js"></script>
  </body>

<!-- /recursive-xhr/  Mon, 24 Jan 2022 10:08:20 GMT -->
</html>
