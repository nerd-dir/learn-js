<!DOCTYPE html>
<html lang="en" class="no-js">

<!-- /todolist-optimistic-ui-delete-tasks/  Mon, 24 Jan 2022 10:04:15 GMT -->
<!-- OpenDir --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /OpenDir -->
<head>
    <meta charset="UTF-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>

<title>üõ†Ô∏è Todolist: Deleting tasks with Optimistic UI | Learn JavaScript</title>
<meta name="description" content="Learn JavaScript student portal"/>
<link rel="canonical" href="index.html">


<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="../../favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicons/favicon-16x16.png">
<link rel="manifest" href="../../favicons/site.webmanifest">
<link rel="mask-icon" href="../../favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="../../favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#ffc40d">
<meta name="msapplication-config" content="../../favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- CSS -->
<link rel="stylesheet" href="../../css/styles-min-afc4baccb2.css">

<!-- Fonts -->
<script>
  (function (d) {
    var config = {
        kitId: 'gas0cwl',
        scriptTimeout: 3000,
        async: true
      },
      h = d.documentElement,
      t = setTimeout(function () {
        h.className = h
          .className
          .replace(/\bwf-loading\b/g, "") + " wf-inactive";
      }, config.scriptTimeout),
      tk = d.createElement("script"),
      f = false,
      s = d.getElementsByTagName("script")[0],
      a;
    h.className += " wf-loading";
    tk.src = 'https://use.typekit.net/' + config.kitId + '.js';
    tk.async = true;
    tk.onload = tk.onreadystatechange = function () {
      a = this.readyState;
      if (f || a && a != "complete" && a != "loaded")
        return;
      f = true;
      clearTimeout(t);
      try {
        Typekit.load(config)
      } catch (e) {}
    };
    s
      .parentNode
      .insertBefore(tk, s)
  })(document);
</script>

<script>
  document
    .documentElement
    .classList
    .remove('no-js')
</script>

</head>

  <body class="page">
      <nav class="main-nav" data-js="menu" data-state="closed">
        <div>
          <a href="../index.html"><svg
  class="logo"
  data-size="small"
  height="1em"
  viewbox="0 0 273 43"
  xmlns="http://www.w3.org/2000/svg"
>
  <g transform="translate(-1 -10)" fill="none" fill-rule="evenodd">
    <rect fill="#F8E201" x="31" y="11" width="217" height="42" />
    <path
      d="M5.21 44.261v-5.217c0-2.726-.706-4.418-3.902-5.076v-3.76c3.196-.705 3.901-2.209 3.901-4.841v-6.11c0-4.606 2.68-8.178 8.695-8.178h1.551v3.995c-3.948 0-5.546 1.645-5.546 5.264v4.23c0 3.196-.94 6.345-4.136 7.473 3.102 1.175 4.136 4.042 4.136 7.05v4.089c0 4.183 1.598 5.828 5.546 5.828v3.995h-1.55c-5.782 0-8.696-3.243-8.696-8.742zm263.967-5.217l.141 5.217c-.141 5.499-2.961 8.742-8.789 8.742h-1.551v-3.995c3.948 0 5.499-1.645 5.499-5.828v-4.089c0-3.008 1.081-5.875 4.183-7.05-3.196-1.128-4.183-4.277-4.183-7.473v-4.23c0-3.619-1.551-5.264-5.499-5.264v-3.995h1.551c5.969 0 8.648 3.572 8.648 8.178v6.11c0 2.632.705 4.136 3.901 4.841v3.76c-3.196.658-3.901 2.35-3.901 5.076z"
      fill="#000"
      fill-rule="nonzero"
    />
    <path
      d="M29.82 52V11.5h7.74v34.56h17.46V52h-25.2zM58.2 37.78c0-8.16 3.54-16.32 13.68-16.32 8.4 0 12.18 5.1 12.18 13.62 0 .96-.06 1.92-.12 3H65.76c.06 7.44 3 9.36 6.54 9.36 2.76 0 5.52-1.2 5.52-4.2 0-.24-.06-.48-.06-.78l6 .84c.06.3.06.66.06 1.02 0 5.4-5.28 8.4-11.76 8.4-8.04 0-13.86-4.62-13.86-14.94zm13.62-11.7c-2.76 0-5.04 2.04-5.82 7.5h10.56v-1.02c0-3.48-1.38-6.48-4.74-6.48zM88.2 44.26c0-6.36 6.06-9.54 12.42-9.54 2.64 0 4.02.6 4.62.96v-4.32c0-3.42-1.32-5.1-4.44-5.1-3.66 0-4.8 2.4-3.96 5.7l-7.02-.78c-1.56-6.84 4.2-9.72 11.4-9.72 7.98 0 11.34 3.48 11.34 9.9v13.26c0 1.38.36 2.04 1.2 2.04 1.08 0 1.92-.96 1.92-.96l.42 5.22s-2.04 1.5-4.92 1.5c-2.94 0-4.98-1.5-5.46-4.62-1.56 2.94-4.56 4.92-8.46 4.92-5.16 0-9.06-3.48-9.06-8.46zm11.28 3.18c2.46 0 4.26-1.38 5.76-3.06v-5.16c-.6 0-1.38-.06-2.34-.06-4.8 0-7.44 1.44-7.44 4.62 0 2.46 1.62 3.66 4.02 3.66zM120.96 52V22.18h5.58l1.02 5.52c1.2-3.18 3.6-6.24 8.1-6.24 6.24 0 7.62 6.66 5.7 11.28l-6.3.84c.84-2.4.96-6-2.04-6-2.64 0-3.96 2.46-4.68 4.56V52h-7.38zm25.86 0V22.18h5.58l.9 4.86c2.22-3.24 4.68-5.58 9.36-5.58 5.04 0 8.88 2.82 8.88 9.18V52h-7.38V32.08c0-3.24-1.2-4.68-3.96-4.68-2.64 0-4.44 1.26-6 2.88V52h-7.38zm47.46-34.86V11.5h17.46v28.8c0 7.5-4.2 12.42-12.18 12.42-8.52 0-13.14-5.52-10.98-13.5l6.84-.72c-1.26 5.16-.06 8.4 3.96 8.4 3.06 0 4.62-1.92 4.62-5.58V17.14h-9.72zm23.94 22.62l6.9-.72c-1.08 4.26 1.2 7.98 8.1 7.98 5.46 0 7.2-2.4 7.2-5.16 0-3.66-3.3-5.04-8.04-6.66-5.76-1.98-13.44-4.38-13.44-12.84 0-7.2 5.52-11.7 14.88-11.58 11.04.12 14.94 6.42 13.74 13.32l-7.32.72c.78-5.76-1.56-8.46-6.96-8.46-4.56 0-6.54 2.04-6.54 5.04 0 4.02 3.72 5.34 8.4 6.9 6.06 1.98 13.02 4.32 13.02 12.36 0 6.84-5.1 12.06-15.24 12.06-9.48 0-16.08-4.5-14.7-12.96z"
      fill="#000"
      fill-rule="nonzero"
    />
  </g>
</svg>
</a>
          <button data-type="secondary" data-js="menu-button">Menu</button>
        </div>
        <div>
          <a href="../index.html">Contents</a>
          <a href="../../components/index.html">Components</a>
          <a href="../../community/index.html">Community</a>
          <a href="../../extras/index.html">Extras</a>
        </div>
        <div>
          <a href="../..https://nerd-dir.com">Account</a>
          <button data-type="secondary" data-js="logout">OpenDir</button>
        </div>
      </nav>

    <noscript>
      <div class="wrap">
        This portal uses JavaScript to check your identity. Please enable JavaScript to access the course.
      </div>
    </noscript>

    <main>
      <div class="wrap">
<div
  data-js="check-auth"
  data-required-authorization="mastery"
  data-auth-state="failure"
>
  <article class="longform" data-failed-content>
    <h1>üõ†Ô∏è Todolist: Deleting tasks with Optimistic UI</h1>
    <p>Hey <span data-js="user-data" data-field="firstName">,</p>
      <p>
      I'm thrilled to help you learn JavaScript. Unfortunately, you've landed on a page where you cannot access with your current purchase.
    </p>
      <p>
      Please upgrade (<a href="../../404/index.html" data-upgrade-link
        >use this link</a
      >) access this content.
    </p>

      <p>I'm super eager to help you learn more!</p>
    </article>

    <article class="longform" data-content>
      <h1>üõ†Ô∏è Todolist: Deleting tasks with Optimistic UI</h1>



      <div class="meta source-code">


    <a href="../../download/components/todolist/13.optimistic-delete-tasks.zip">
      <svg class="icon" viewBox="0 0 20 20" height="1em">
        <path fill="currentColor" d="M.7 9.3l4.8-4.8 1.4 1.42L2.84 10l4.07 4.07-1.41 1.42L0 10l.7-.7zm18.6 1.4l.7-.7-5.49-5.49-1.4 1.42L17.16 10l-4.07 4.07 1.41 1.42 4.78-4.78z"/>
      </svg>
      <span>Source</span>
    </a>
      </div><p>When we delete tasks the Optimistic UI way, we need to:</p>
<ol>
<li>Delete the task from the DOM</li>
<li>Send a DELETE request to the server</li>
<li>Handle the loading state</li>
<li>Handle the loaded state</li>
<li>Handle any errors that surface</li>
</ol>
<p>Now, this sounds straightforward. But it isn‚Äôt.</p>
<p>Let‚Äôs walk through the steps and you‚Äôll see why.</p>
<h2 id="optimistic-ui-for-deleting-tasks%3A-first-try">Optimistic UI for deleting tasks: First try</h2>
<h3 id="deleting-a-task-from-the-dom">Deleting a task from the DOM</h3>
<p>When a user clicks on the delete icon, we want to remove the task from the DOM. This should be easy since you‚Äôve done it before.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  if (!event.target.matches('.task__delete-button')) return

  const taskElement = event.target.parentElement
  taskList.removeChild(taskElement)

  // Triggers empty state
  if (taskList.children.length === 0) taskList.innerHTML = ''
})
</code></pre>
<h3 id="send-a-delete-request">Send a delete request</h3>
<p>To send a DELETE request, we need to know the task‚Äôs <code>id</code>. We can find the task‚Äôs <code>id</code> from its checkbox.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  const checkbox = taskElement.querySelector('input[type=&quot;checkbox&quot;]')
  const id = checkbox.id
})
</code></pre>
<p>Once we have the <code>id</code>, we can send a DELETE request.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  zlFetch.delete(`${rootendpoint}/tasks/${id}`, { auth })
    .then(response =&gt; console.log(response))
    .catch(error =&gt; console.log(error))
})
</code></pre>
<h3 id="handle-the-loading-state">Handle the loading state</h3>
<p>When we added a task, we used a spinner to tell users we‚Äôre adding their task to the database.</p>
<p>When we delete tasks, we don‚Äôt need a loading state because users won‚Äôt interact with the task anymore. This means we don‚Äôt need to do anything for the loading state.</p>
<h3 id="handle-the-loaded-state">Handle the loaded state</h3>
<p>We need to remove the deleted task from <code>state.tasks</code>.</p>
<p>First, we need to find the location of the task in <code>state.tasks</code>. We can find this location with <code>findIndex</code>.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  zlFetch.delete(`${rootendpoint}/tasks/${id}`, { auth })
    .then(response =&gt; {
      const index = state.tasks.findIndex(t =&gt; t.id === id)
     })
    .catch(error =&gt; console.log(error))
})
</code></pre>
<p>Then, we remove the task from <code>state.tasks</code> by using a combination of spread operators and <code>slice</code>. (Read <a href="../rest-and-spread/index.html">this lesson</a> again if this step sounds confusing).</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  zlFetch.delete(`${rootendpoint}/tasks/${id}`, { auth })
    .then(response =&gt; {
      const index = state.tasks.findIndex(t =&gt; t.id === id)
      state.tasks = [
        ...state.tasks.slice(0, index),
        ...state.tasks.slice(index + 1)
      ]
     })
    .catch(error =&gt; console.log(error))
})
</code></pre>
<h3 id="handling-errors">Handling errors</h3>
<p>If an error occurs, we need to:</p>
<ol>
<li>Create an error message</li>
<li>Restore the task back to the DOM</li>
</ol>
<p>It‚Äôs easy to create an error message. You already know what to do.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  zlFetch.delete(/*...*/)
    .catch(error =&gt; {
      let errorMessage = ''
      const { message } = error.body
      if (message === 'TypeError: Failed to fetch') {
        errorMessage = 'Failed to reach server. Please try again later.'
      } else if (message === 'Unauthorized') {
        errorMessage = 'Invalid username or password. Please check your username or password.'
      } else {
        errorMessage = error.body.message
      }

      const errorElement = makeErrorElement(errorMessage)
      flashContainer.appendChild(errorElement)
    })
})
</code></pre>
<p>We also need to restore the task back to the DOM. Here, we want to restore the task back to its original location.</p>
<p>If the user deletes one item at a time, restoring the task back to its original location is easy. We can use <code>insertBefore</code> to insert the task back to the original location.</p>
<p>To use <code>insertBefore</code>, you need to know the next task. To get the next task, you can use <code>nextElementSibling</code>.</p>
<p>If the deleted task is the last task, we need to use <code>appendChild</code> instead.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  const nextTaskElement = taskElement.nextElementSibling

  zlFetch.delete(/*...*/)
    .catch(error =&gt; {
      // ...
      if (nextTaskElement) {
        taskList.insertBefore(taskElement, nextTaskElement)
      } else {
        taskList.appendChild(taskElement)
      }
  })
})
</code></pre>
<figure role="figure"><img src="../../images/components/todolist/optimistic-delete-tasks/delete-first-try.gif" alt="Deletes a task. Shows error. Task returned to original position."></figure>
<p>Unfortunately, things go haywire if users delete more than one task at a time. We won‚Äôt be able to put the deleted task back to where it belongs.</p>
<p>(I disabled error messages for the gif below).</p>
<figure role="figure" aria-label="Unable to restore the original task positions"><img src="../../images/components/todolist/optimistic-delete-tasks/delete-fail.gif" alt=""><figcaption>Unable to restore the original task positions</figcaption></figure>
<p>We need to use another method.</p>
<h2 id="optimistic-ui-for-deleting-tasks%3A-second-try">Optimistic UI for deleting tasks: Second try</h2>
<p>Here‚Äôs a possible method:</p>
<ol>
<li>We <strong>hide the task</strong> when user clicks the delete button.</li>
<li>Then, we send a DELETE request to the server.</li>
<li>If successful response: we delete task from DOM.</li>
<li>If error response: we show the hidden task.</li>
</ol>
<h3 id="hiding-the-task">Hiding the task</h3>
<p>To hide the task, we can use the <code>hidden</code> attribute.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  const taskElement = event.target.parentElement
  taskElement.setAttribute('hidden', true)
})
</code></pre>
<h3 id="sending-the-delete-request">Sending the delete request</h3>
<p>Next, we get the task‚Äôs <code>id</code> to send a DELETE request.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  const checkbox = taskElement.querySelector('input[type=&quot;checkbox&quot;]')
  const id = checkbox.id

  zlFetch.delete(`${rootendpoint}/tasks/${id}`, { auth })
    .then(response =&gt; console.log(response))
    .catch(error =&gt; console.log(error))
})
</code></pre>
<h3 id="handling-a-successful-response">Handling a successful response</h3>
<p>When we receive a successful response, we delete the task.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...

  zlFetch.delete(/*...*/)
    .then(response =&gt; {
      // Deletes task
      taskList.removeChild(taskElement)
    })
    .catch(error =&gt; console.log(error))
})
</code></pre>
<p>We also update <code>state.tasks</code>.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...

  zlFetch.delete(/*...*/)
    .then(response =&gt; {
      // ...
      // Update state.tasks
      const index = state.tasks.findIndex(t =&gt; t.id === id)
      state.tasks = [
        ...state.tasks.slice(0, index),
        ...state.tasks.slice(index + 1)
      ]
    })
    .catch(error =&gt; console.log(error))
})
</code></pre>
<h3 id="handling-errors-2">Handling errors</h3>
<p>If we get an error, we show the task by removing the <code>hidden</code> attribute.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...

  zlFetch.delete(/*...*/)
    .then(/*...*/)
    .catch(error =&gt; {
      // Show the task
      taskElement.removeAttribute('hidden')
     })
})
</code></pre>
<p>We also create an error message.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...

  zlFetch.delete(/*...*/)
    .then(/*...*/)
    .catch(error =&gt; {
      // ...
      taskElement.removeAttribute('hidden')

      // Create error message
      let errorMessage = ''
      const { message } = error.body
      if (message === 'TypeError: Failed to fetch') {
        errorMessage = 'Failed to reach server. Please try again later.'
      } else if (message === 'Unauthorized') {
        errorMessage = 'Invalid username or password. Please check your username or password.'
      } else {
        errorMessage = error.body.message
      }

      const errorElement = makeErrorElement(errorMessage)
      flashContainer.appendChild(errorElement)
     })
})
</code></pre>
<p>You can delete tasks in any order now. The deleted tasks will always go back to their rightful positions if an error occurs.</p>
<p>(I removed the error messages in the gif below).</p>
<figure role="figure"><img src="../../images/components/todolist/optimistic-delete-tasks/delete-error-multi.gif" alt="Tasks go back to their rightful positions."></figure>
<h2 id="fixing-the-empty-state">Fixing the empty state</h2>
<p>The empty state shows up if <code>taskList</code> contains 0 children elements. It doesn‚Äôt show up if <code>taskList</code> contains children elements (even if they‚Äôre hidden).</p>
<figure role="figure"><img src="../../images/components/todolist/optimistic-delete-tasks/empty-state-noshow.png" alt="Empty state doesn't show when tasks are hidden"></figure>
<p>We need it to show up if all children elements in <code>taskList</code> are hidden. The easiest way is to add an <code>is-empty</code> class to <code>taskList</code>.</p>
<p>We can use <code>every</code> to check if all tasks contain the <code>hidden</code> attribute.</p>
<p><code>every</code> loops through an array of items. For each iteration, it checks if the callback is truthy. If the callback is truthy, it continues to the next iteration. If all iterations are truthy, <code>every</code> returns <code>true</code>. Otherwise, it returns <code>false</code>.</p>
<pre><code class="language-js">// Every example
const biggerThanTen = item =&gt; {
  return item &gt; 10
}

const array1 = [15, 20, 25].every(biggerThanTen)
console.log(array1) // true

const array2 = [5, 10, 15].every(biggerThanTen)
console.log(array2) // false
</code></pre>
<p>We can use <code>every</code> like this:</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  const allTasksAreHidden = [...taskList.children]
    .every(element =&gt; {
      return element.hasAttribute('hidden')
    })
  // ...
})
</code></pre>
<p>If all tasks are hidden, we add the <code>is-empty</code> class. Otherwise, we remove it.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  if (allTasksAreHidden) {
    taskList.classList.add('is-empty')
  } else {
    taskList.classList.remove('is-empty')
  }
  // ...
})
</code></pre>
<p>We‚Äôll have to add this CSS for the code above to work.</p>
<pre><code class="language-css">.todolist__tasks.is-empty ~ .todolist__empty-state {
  display: block;
}
</code></pre>
<figure role="figure"><img src="../../images/components/todolist/optimistic-delete-tasks/empty-state-show.gif" alt="Empty state shows when hiding tasks."></figure>
<p>If the server returns an error, we need to hide the empty state. We can copy-paste the code we wrote above into the <code>.catch</code> method to do this.</p>
<pre><code class="language-js">taskList.addEventListener('click', event =&gt; {
  // ...
  zlFetch.delete(/*...*/)
    .then(/*...*/)
    .catch({
      // ...
      // Checks empty state
      const allTasksAreHidden = [...taskList.children]
        .every(element =&gt; {
          return element.hasAttribute('hidden')
        })

      if (allTasksAreHidden) {
        taskList.classList.add('is-empty')
      } else {
        taskList.classList.remove('is-empty')
      }
    })
})
</code></pre>
<h3 id="hiding-the-empty-state-when-adding-tasks">Hiding the empty state when adding tasks</h3>
<p>Try deleting all your tasks. This should trigger the empty state. Once you see the empty state, try adding a task. You should still see the empty state.</p>
<figure role="figure"><img src="../../images/components/todolist/optimistic-delete-tasks/empty-state-stays-on.gif" alt="Delete all tasks. Create a task. Empty state still shows. "></figure>
<p>This happens because we left the <code>is-empty</code> class in the HTML after we deleted tasks.</p>
<p>The best way to hide the empty state when adding tasks is to remove the <code>is-empty</code> class.</p>
<pre><code class="language-js">todolist.addEventListener('submit', event =&gt; {
  // ...

  // Hides the empty state
  taskList.classList.remove('is-empty')

  zlFetch.post(/*...*/)
    .then(/*...*/)
    .catch(/*...*/)
})
</code></pre>
<p>If the server responds with an error, we need to show the empty state again. We don‚Äôt have to do anything here because the <code>:empty</code> pseudo selector will take care of the rest.</p>
<p>That‚Äôs it!</p>
</article>
  </div>



  <div class="longform">
    <nav class="lesson-nav">

          <a href="../todolist-optimistic-ui-update-tasks/index.html" data-link-to="previous-lesson">
              <svg height="1em" viewbox="0 0 22 38">
                <path
          fill="currentColor"
          d="M18.9 38l3.1-3.1L6.1 19 22 3.1 18.9 0 0 19z"
        ></path>
              </svg>
              <span>üõ†Ô∏è Todolist: Editing tasks with Optimistic UI</span>
            </a>
          <a href="../todolist-refactor/index.html" data-link-to="next-lesson">
              <span>üõ†Ô∏è Todolist: Refactor</span>
              <svg height="1em" viewbox="0 0 22 38">
                <path
          fill="currentColor"
          d="M3.1 0L0 3.1 15.9 19 0 34.9 3.1 38 22 19z"
        ></path>
              </svg>
            </a>
          </nav>
  </div>
</div>
    </main>



      <script module src="../../js/main-b9439821d7.mjs"></script>
      <script nomodule src="../../js/main-legacy-8c54230a8f.js"></script>
  </body>

<!-- /todolist-optimistic-ui-delete-tasks/  Mon, 24 Jan 2022 10:04:16 GMT -->
</html>
