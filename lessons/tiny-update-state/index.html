<!DOCTYPE html>
<html lang="en" class="no-js">

<!-- /tiny-update-state/  Mon, 24 Jan 2022 10:07:42 GMT -->
<!-- OpenDir --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /OpenDir -->
<head>
    <meta charset="UTF-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>

<title>üõ†Ô∏è Tiny: Updating state | Learn JavaScript</title>
<meta name="description" content="Learn JavaScript student portal"/>
<link rel="canonical" href="index.html">


<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="../../favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicons/favicon-16x16.png">
<link rel="manifest" href="../../favicons/site.webmanifest">
<link rel="mask-icon" href="../../favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="../../favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#ffc40d">
<meta name="msapplication-config" content="../../favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- CSS -->
<link rel="stylesheet" href="../../css/styles-min-afc4baccb2.css">

<!-- Fonts -->
<script>
  (function (d) {
    var config = {
        kitId: 'gas0cwl',
        scriptTimeout: 3000,
        async: true
      },
      h = d.documentElement,
      t = setTimeout(function () {
        h.className = h
          .className
          .replace(/\bwf-loading\b/g, "") + " wf-inactive";
      }, config.scriptTimeout),
      tk = d.createElement("script"),
      f = false,
      s = d.getElementsByTagName("script")[0],
      a;
    h.className += " wf-loading";
    tk.src = 'https://use.typekit.net/' + config.kitId + '.js';
    tk.async = true;
    tk.onload = tk.onreadystatechange = function () {
      a = this.readyState;
      if (f || a && a != "complete" && a != "loaded")
        return;
      f = true;
      clearTimeout(t);
      try {
        Typekit.load(config)
      } catch (e) {}
    };
    s
      .parentNode
      .insertBefore(tk, s)
  })(document);
</script>

<script>
  document
    .documentElement
    .classList
    .remove('no-js')
</script>

</head>

  <body class="page">
      <nav class="main-nav" data-js="menu" data-state="closed">
        <div>
          <a href="../index.html"><svg
  class="logo"
  data-size="small"
  height="1em"
  viewbox="0 0 273 43"
  xmlns="http://www.w3.org/2000/svg"
>
  <g transform="translate(-1 -10)" fill="none" fill-rule="evenodd">
    <rect fill="#F8E201" x="31" y="11" width="217" height="42" />
    <path
      d="M5.21 44.261v-5.217c0-2.726-.706-4.418-3.902-5.076v-3.76c3.196-.705 3.901-2.209 3.901-4.841v-6.11c0-4.606 2.68-8.178 8.695-8.178h1.551v3.995c-3.948 0-5.546 1.645-5.546 5.264v4.23c0 3.196-.94 6.345-4.136 7.473 3.102 1.175 4.136 4.042 4.136 7.05v4.089c0 4.183 1.598 5.828 5.546 5.828v3.995h-1.55c-5.782 0-8.696-3.243-8.696-8.742zm263.967-5.217l.141 5.217c-.141 5.499-2.961 8.742-8.789 8.742h-1.551v-3.995c3.948 0 5.499-1.645 5.499-5.828v-4.089c0-3.008 1.081-5.875 4.183-7.05-3.196-1.128-4.183-4.277-4.183-7.473v-4.23c0-3.619-1.551-5.264-5.499-5.264v-3.995h1.551c5.969 0 8.648 3.572 8.648 8.178v6.11c0 2.632.705 4.136 3.901 4.841v3.76c-3.196.658-3.901 2.35-3.901 5.076z"
      fill="#000"
      fill-rule="nonzero"
    />
    <path
      d="M29.82 52V11.5h7.74v34.56h17.46V52h-25.2zM58.2 37.78c0-8.16 3.54-16.32 13.68-16.32 8.4 0 12.18 5.1 12.18 13.62 0 .96-.06 1.92-.12 3H65.76c.06 7.44 3 9.36 6.54 9.36 2.76 0 5.52-1.2 5.52-4.2 0-.24-.06-.48-.06-.78l6 .84c.06.3.06.66.06 1.02 0 5.4-5.28 8.4-11.76 8.4-8.04 0-13.86-4.62-13.86-14.94zm13.62-11.7c-2.76 0-5.04 2.04-5.82 7.5h10.56v-1.02c0-3.48-1.38-6.48-4.74-6.48zM88.2 44.26c0-6.36 6.06-9.54 12.42-9.54 2.64 0 4.02.6 4.62.96v-4.32c0-3.42-1.32-5.1-4.44-5.1-3.66 0-4.8 2.4-3.96 5.7l-7.02-.78c-1.56-6.84 4.2-9.72 11.4-9.72 7.98 0 11.34 3.48 11.34 9.9v13.26c0 1.38.36 2.04 1.2 2.04 1.08 0 1.92-.96 1.92-.96l.42 5.22s-2.04 1.5-4.92 1.5c-2.94 0-4.98-1.5-5.46-4.62-1.56 2.94-4.56 4.92-8.46 4.92-5.16 0-9.06-3.48-9.06-8.46zm11.28 3.18c2.46 0 4.26-1.38 5.76-3.06v-5.16c-.6 0-1.38-.06-2.34-.06-4.8 0-7.44 1.44-7.44 4.62 0 2.46 1.62 3.66 4.02 3.66zM120.96 52V22.18h5.58l1.02 5.52c1.2-3.18 3.6-6.24 8.1-6.24 6.24 0 7.62 6.66 5.7 11.28l-6.3.84c.84-2.4.96-6-2.04-6-2.64 0-3.96 2.46-4.68 4.56V52h-7.38zm25.86 0V22.18h5.58l.9 4.86c2.22-3.24 4.68-5.58 9.36-5.58 5.04 0 8.88 2.82 8.88 9.18V52h-7.38V32.08c0-3.24-1.2-4.68-3.96-4.68-2.64 0-4.44 1.26-6 2.88V52h-7.38zm47.46-34.86V11.5h17.46v28.8c0 7.5-4.2 12.42-12.18 12.42-8.52 0-13.14-5.52-10.98-13.5l6.84-.72c-1.26 5.16-.06 8.4 3.96 8.4 3.06 0 4.62-1.92 4.62-5.58V17.14h-9.72zm23.94 22.62l6.9-.72c-1.08 4.26 1.2 7.98 8.1 7.98 5.46 0 7.2-2.4 7.2-5.16 0-3.66-3.3-5.04-8.04-6.66-5.76-1.98-13.44-4.38-13.44-12.84 0-7.2 5.52-11.7 14.88-11.58 11.04.12 14.94 6.42 13.74 13.32l-7.32.72c.78-5.76-1.56-8.46-6.96-8.46-4.56 0-6.54 2.04-6.54 5.04 0 4.02 3.72 5.34 8.4 6.9 6.06 1.98 13.02 4.32 13.02 12.36 0 6.84-5.1 12.06-15.24 12.06-9.48 0-16.08-4.5-14.7-12.96z"
      fill="#000"
      fill-rule="nonzero"
    />
  </g>
</svg>
</a>
          <button data-type="secondary" data-js="menu-button">Menu</button>
        </div>
        <div>
          <a href="../index.html">Contents</a>
          <a href="../../components/index.html">Components</a>
          <a href="../../community/index.html">Community</a>
          <a href="../../extras/index.html">Extras</a>
        </div>
        <div>
          <a href="../..https://nerd-dir.com">Account</a>
          <button data-type="secondary" data-js="logout">OpenDir</button>
        </div>
      </nav>

    <noscript>
      <div class="wrap">
        This portal uses JavaScript to check your identity. Please enable JavaScript to access the course.
      </div>
    </noscript>

    <main>
      <div class="wrap">
<div
  data-js="check-auth"
  data-required-authorization="mastery"
  data-auth-state="failure"
>
  <article class="longform" data-failed-content>
    <h1>üõ†Ô∏è Tiny: Updating state</h1>
    <p>Hey <span data-js="user-data" data-field="firstName">,</p>
      <p>
      I'm thrilled to help you learn JavaScript. Unfortunately, you've landed on a page where you cannot access with your current purchase.
    </p>
      <p>
      Please upgrade (<a href="../../404/index.html" data-upgrade-link
        >use this link</a
      >) access this content.
    </p>

      <p>I'm super eager to help you learn more!</p>
    </article>

    <article class="longform" data-content>
      <h1>üõ†Ô∏è Tiny: Updating state</h1>



      <div class="meta source-code">


    <a href="../../download/components/tiny/04.update-state.zip">
      <svg class="icon" viewBox="0 0 20 20" height="1em">
        <path fill="currentColor" d="M.7 9.3l4.8-4.8 1.4 1.42L2.84 10l4.07 4.07-1.41 1.42L0 10l.7-.7zm18.6 1.4l.7-.7-5.49-5.49-1.4 1.42L17.16 10l-4.07 4.07 1.41 1.42 4.78-4.78z"/>
      </svg>
      <span>Source</span>
    </a>
      </div><p>State is usually a term given to a component‚Äôs value that changes when an event happens. In this case, both the parent‚Äôs count and child count are considered to be states.</p>
<p>We can create a state property to hold any initial state values.</p>
<pre><code class="language-javascript">Tiny({
  // ...
  state: {
    count: 10,
    childCount: 5
  }
})
</code></pre>
<p>We can then render these values by using <code>this</code> in <code>template</code>. It works because <code>this</code> points back to the component which contains the state.</p>
<pre><code class="language-javascript">Tiny({
  // ...
  template () {
    console.log(this)
  }
})
</code></pre>
<figure role="figure">
  <img src="../../images/components/tiny/update-state/state.png" alt="">
</figure>
<p>This is how we render the parent‚Äôs initial count.</p>
<pre><code class="language-javascript">Tiny({
  // ...
  template () {
    return `
      &lt;div class=&quot;component parent-component flow&quot;&gt;
        &lt;h1&gt;Parent Counter&lt;/h1&gt;
        &lt;p&gt;Count: ${this.state.count}&lt;/p&gt;
        &lt;button tiny-listener=&quot;[click, increaseCount]&quot;&gt;Increase count by 1&lt;/button&gt;
		    &lt;!-- ... --&gt;
      &lt;/div&gt;
    `
  }
})
</code></pre>
<figure role="figure">
  <img src="../../images/components/tiny/update-state/parent.png" alt="">
</figure>
<p>And this is how we render the child‚Äôs initial count.</p>
<pre><code class="language-html">&lt;!-- Child's counter --&gt;
&lt;h2&gt;Child Counter&lt;/h2&gt;
&lt;p&gt;Count: ${this.state.childCount}&lt;/p&gt;

&lt;!-- Total counter --&gt;
&lt;h2&gt;Total Count&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Parent Count: ${this.state.count}&lt;/li&gt;
  &lt;li&gt;Child Count: ${this.state.childCount}&lt;/li&gt;
  &lt;li&gt;Total Count: ${this.state.count + this.state.childCount}&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<figure role="figure">
  <img src="../../images/components/tiny/update-state/counter-app.png" alt="">
</figure>
<h2 id="accessing-state">Accessing State</h2>
<p>Event handlers need to be able to access state. Unfortunately, they cannot access state right now because <code>this</code> points back to the listening element.</p>
<video autoplay loop>
  <source src="../../images/components/tiny/update-state/this.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/tiny/update-state/this.mp4"> here </a> instead.
</video>
<p>This is correct because <code>this</code> points back to the listener element if you use a normal callback function. We talked about it in the <a href="../this-in-javascript/index.html">lesson on this</a>.</p>
<p>If we want to access <code>this</code> inside each event handler, we need to change the value of <code>this</code> with <code>bind</code>. In this case, we bind <code>options</code> as <code>this</code> because <code>options</code> is essentially the component itself.</p>
<pre><code class="language-javascript">export default function Tiny (options) {
  // ...
  function _addEventListeners () {
      // ...
      listenerElement.addEventListener(eventName, options[fn].bind(options))
    }
  }
}
</code></pre>
<p>Once we do this we can access <code>state</code> with <code>this</code> inside the event listener. We can also access other methods and properties.</p>
<video autoplay loop>
  <source src="../../images/components/tiny/update-state/this2.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/tiny/update-state/this2.mp4"> here </a> instead.
</video>
<h2 id="changing-the-state">Changing the state</h2>
<p>We can change the <code>state</code> object directly inside the event listener, but nothing will change in the DOM.</p>
<pre><code class="language-javascript">Tiny ({
  // ...
  increaseCount (event) {
    this.state.count = this.state.count + 1
  }
  // ...
})
</code></pre>
<video autoplay loop>
  <source src="../../images/components/tiny/update-state/nothing.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/tiny/update-state/nothing.mp4"> here </a> instead.
</video>
<p>That‚Äôs because changing the <code>state</code> object is not enough. We did not render the new state back into the DOM.</p>
<p>To render the new state back into the DOM, we need to call the <code>_render</code> function. But <code>Tiny</code> users cannot use this function since we did not expose it.</p>
<p>This means we need to give users a way to tell Tiny that the state has changed. And when the state changes, Tiny should re-render the DOM.</p>
<p>React calls this method <code>setState</code>. Let‚Äôs call ours <code>setState</code> too.</p>
<pre><code class="language-javascript">export default function Tiny (options) {
  // ...
  function setState () {
    console.log('Setting state')
  }
}
</code></pre>
<p>We need to give Tiny users access to <code>setState</code>. One way to give this access is to declare <code>setState</code> as a method of <code>options</code>.</p>
<pre><code class="language-javascript">export default function Tiny (options) {
  // ...
  options.setState = function () {
    console.log('Setting state')
  }
}
</code></pre>
<pre><code class="language-javascript">Tiny({
  // ...
  increaseCount (event) {
    this.setState()
  },
  // ...
})
</code></pre>
<video autoplay loop>
  <source src="../../images/components/tiny/update-state/access-set-state.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/tiny/update-state/access-set-state.mp4"> here </a> instead.
</video>
<p>We can change the <code>state</code> values inside <code>setState</code> and call the <code>_render</code> function again. To prove this point, let‚Äôs set <code>count</code> to 100 in <code>setState</code>.</p>
<pre><code class="language-javascript">export default function Tiny (options) {
  // ...
  options.setState = () {
    options.state.count = 100
    _render()
  }
}
</code></pre>
<video autoplay loop>
  <source src="../../images/components/tiny/update-state/fixed-state.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/tiny/update-state/fixed-state.mp4"> here </a> instead.
</video>
<p>But we don‚Äôt want to fix the <code>count</code>. We want to let users set the state themselves.</p>
<p>One way to do this is to let them pass in an object that contains the values they want to set. We‚Äôll then loop through every property in this object and assign it back into <code>state</code>.</p>
<p>After assigning the properties back into <code>state</code>, we call <code>_render</code> so the component gets re-rendered.</p>
<pre><code class="language-javascript">export default function Tiny (options) {
  // ...
  options.setState = function (newState) {
    const entries = Object.entries(newState)
    for (const entry of entries) {
      options.state[entry[0]] = entry[1]
    }
    _render()
  }
  // ...
}
</code></pre>
<p>We can now pass in the new <code>count</code> value into <code>setState</code>.</p>
<pre><code class="language-javascript">Tiny({
  // ...
  increaseCount (event) {
    this.setState({
      count: this.state.count + 1
    })
  }
  // ...
})
</code></pre>
<p>This works, but the DOM only updates one time. Why? It happened because we didn‚Äôt simply change the <code>textContent</code> of the values that need to be changed. We re-rendered the entire component, so event listeners are removed.</p>
<video autoplay loop>
  <source src="../../images/components/tiny/update-state/log-once.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/tiny/update-state/log-once.mp4"> here </a> instead.
</video>
<p>To fix this problem, we need to add event listeners after we call <code>_render</code>.</p>
<pre><code class="language-javascript">export default function Tiny (options) {
  // ...
  options.setState = function (newState) {
    const entries = Object.entries(newState)
    for (const entry of entries) {
      options.state[entry[0]] = entry[1]
    }
    _render()
    _addEventListeners()
  }
  // ...
}
</code></pre>
<video autoplay loop>
  <source src="../../images/components/tiny/update-state/readd-el.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/tiny/update-state/readd-el.mp4"> here </a> instead.
</video>
<h2 id="dom-diffing">DOM Diffing</h2>
<p>Usable frameworks like React and Vue don‚Äôt re-render the entire component. It takes too much time from a performance standpoint.</p>
<p>Instead, they use a process called DOM Diffing which checks the differences in the DOM so they change only things that need to be changed.</p>
<p>There are two kinds of DOM Diffing:</p>
<ul>
<li>Actual DOM Diffing ‚Äî where you compare your new HTML with the actual HTML in the DOM.</li>
<li>Virtual DOM Diffing ‚Äî where you compare your new HTML with the current HTML that was saved in JavaScript.</li>
</ul>
<p>It can be challenging to implement DOM Diffing so we skipped it and chose to re-render the entire component instead. This choice creates performance problems so I don‚Äôt recommend using Tiny as a real framework in your projects. But it serves enough to understand what goes behind the scenes when you use a framework.</p>
<h2 id="finishing-up">Finishing up</h2>
<p>Let‚Äôs finish up the counter component by increasing <code>childCount</code> when the appropriate button is pressed.</p>
<pre><code class="language-javascript">Tiny ({
  // ...
  increaseChildCount (event) {
    this.setState({
      childCount: this.state.childCount + 1
    })
  }
  // ...
})
</code></pre>
<video autoplay loop>
  <source src="../../images/components/tiny/update-state/child-count.mp4" type="video/mp4">
  Your browser doesn't support embedded videos. Watch the video <a href="../../images/components/tiny/update-state/child-count.mp4"> here </a> instead.
</video>
</article>
  </div>



  <div class="longform">
    <nav class="lesson-nav">

          <a href="../tiny-add-event-listeners/index.html" data-link-to="previous-lesson">
              <svg height="1em" viewbox="0 0 22 38">
                <path
          fill="currentColor"
          d="M18.9 38l3.1-3.1L6.1 19 22 3.1 18.9 0 0 19z"
        ></path>
              </svg>
              <span>üõ†Ô∏è Tiny: Add event listeners</span>
            </a>
          <a href="../tiny-child-components/index.html" data-link-to="next-lesson">
              <span>üõ†Ô∏è Tiny: Rendering Child Components</span>
              <svg height="1em" viewbox="0 0 22 38">
                <path
          fill="currentColor"
          d="M3.1 0L0 3.1 15.9 19 0 34.9 3.1 38 22 19z"
        ></path>
              </svg>
            </a>
          </nav>
  </div>
</div>
    </main>



      <script module src="../../js/main-b9439821d7.mjs"></script>
      <script nomodule src="../../js/main-legacy-8c54230a8f.js"></script>
  </body>

<!-- /tiny-update-state/  Mon, 24 Jan 2022 10:07:45 GMT -->
</html>
